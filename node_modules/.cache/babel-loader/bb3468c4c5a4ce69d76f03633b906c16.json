{"ast":null,"code":"var _jsxFileName = \"/home/harish/windo/phoenix/src/containers/profile/paymentMode/PaymentMode.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useRef } from 'react';\nimport { Drawer } from \"../../../components/shared/Drawer\";\nimport { Button, Card } from 'phoenix-components';\nimport { Switch as DefaultSwitch } from 'phoenix-components';\nimport { Formik } from 'formik';\nimport { useRefreshShop, useShop } from \"../../../contexts/userContext\";\nimport { useToggle } from \"../../../hooks/common\";\nimport SnackBar from \"../../../services/snackbar\";\nimport cx from 'classnames';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport { Becca } from \"../../../api\";\nimport Loader from \"../../../services/loader\";\nimport { PaymentPartners } from \"../../lazy\";\nimport { isPayPalAllowed, isStripeAllowed } from \"../../../utils/countries\";\nimport Kbc from \"../../../components/knowBaseCards/KnowBaseCards.jsx\";\nimport EventManager from \"../../../utils/events\";\nimport Accordion from \"./Accordion\";\nimport CustomPayments from \"./CustomPayments\";\nimport styles from \"./PaymentMode.module.css\";\nimport { getInitialValues, schema } from \"./utils\";\n\nfunction PaymentMode() {\n  _s();\n\n  const {\n    paymentModes,\n    country,\n    accounts = []\n  } = useShop();\n  const isIndia = (country === null || country === void 0 ? void 0 : country.toLowerCase()) === 'india';\n  const paymentsEnabled = accounts.filter(x => x.enabled).length > 0;\n  const refreshShop = useRefreshShop();\n  const history = useHistory();\n  const location = useLocation();\n  const stripeAllowed = isStripeAllowed(country);\n  const payPalAllowed = isPayPalAllowed(country);\n  const [openOnline, toggleOnline] = useToggle(false);\n  const [openManual, toggleManual] = useToggle(false);\n  const buttonRef = useRef();\n\n  const defaultSwitchManual = values => {\n    if (openManual) {\n      return true;\n    }\n\n    if (isIndia) {\n      return values.cod.enabled || values.custompayment.enabled;\n    }\n\n    if (stripeAllowed || payPalAllowed) {\n      return values.cod.enabled || values.custompayment.enabled;\n    }\n\n    return values.cod.enabled;\n  };\n\n  const toggleSave = () => {\n    if (buttonRef.current) {\n      buttonRef.current.firstElementChild.click();\n    }\n  };\n\n  const defaultSwitchManualChange = (setValue, val, isEmptyConfigured) => {\n    if (isIndia || stripeAllowed || payPalAllowed) {\n      setValue('cod.enabled', val);\n      setValue('custompayment.enabled', val);\n\n      if (isEmptyConfigured) {\n        setValue('custompayment.enabled', false);\n      }\n\n      toggleSave();\n      return;\n    }\n\n    setValue('cod.enabled', val);\n    toggleSave();\n  };\n\n  const defaultSwitchOnline = values => {\n    if (openOnline) {\n      return true;\n    }\n\n    if (isIndia || stripeAllowed || payPalAllowed) {\n      return values.online.enabled;\n    }\n\n    return values.custompayment.enabled;\n  };\n\n  const defaultSwitchOnlineChange = (setValue, val) => {\n    if (isIndia) {\n      setValue('online.enabled', val);\n      toggleSave();\n      return;\n    }\n\n    if (stripeAllowed || payPalAllowed) {\n      if (!paymentsEnabled && val) {\n        SnackBar.show('Please activate atleast one partner', 'error');\n        return;\n      }\n\n      setValue('online.enabled', val);\n      toggleSave();\n      return;\n    }\n\n    setValue('custompayment.enabled', val);\n    toggleSave();\n  };\n\n  const onSubmit = async values => {\n    try {\n      var _location$state;\n\n      Loader.show();\n      await Becca.updateShop({\n        paymentModes: values\n      });\n      EventManager.emitEvent('payments_enabled');\n      SnackBar.show('Payment settings updated successfully', 'success');\n      refreshShop();\n\n      if (location !== null && location !== void 0 && (_location$state = location.state) !== null && _location$state !== void 0 && _location$state.redirectTo) {\n        history.push(location.state.redirectTo);\n        return;\n      }\n    } catch (e) {\n      SnackBar.showError(e);\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const onCodSelect = setField => value => {\n    setField('cod.enabled', value);\n    toggleSave();\n  };\n\n  return /*#__PURE__*/React.createElement(Drawer, {\n    title: \"Payment Settings\",\n    containerClass: styles.drawer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Formik, {\n    validationSchema: schema,\n    initialValues: getInitialValues(paymentModes),\n    onSubmit: onSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 7\n    }\n  }, ({\n    values,\n    setFieldValue,\n    submitForm\n  }) => /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.main,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.heading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 15\n    }\n  }, \"Choose Payment Modes\"), /*#__PURE__*/React.createElement(Card, {\n    className: cx(styles.mode),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: cx(styles.cod, {\n      [styles.active]: defaultSwitchOnline(values)\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.modeName,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 19\n    }\n  }, \"Online\"), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(DefaultSwitch, {\n    active: defaultSwitchOnline(values),\n    onChange: (e, val) => {\n      defaultSwitchOnlineChange(setFieldValue, val);\n      toggleOnline();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 21\n    }\n  }))), !stripeAllowed && !payPalAllowed && !isIndia && /*#__PURE__*/React.createElement(Accordion, {\n    label: \"Direct Payments\",\n    name: \"custompayment.enabled\",\n    openDefault: values.custompayment.configured.length === 0,\n    onChange: e => {\n      if (values.custompayment.configured.length === 0 && !values.cod.enabled && e) {\n        SnackBar.show('Please add atleast one custom payment', 'error');\n        return;\n      }\n\n      setFieldValue('custompayment.enabled', e);\n      toggleSave();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(CustomPayments, {\n    toggleSave: toggleSave,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 21\n    }\n  })), defaultSwitchOnline(values) && (stripeAllowed || payPalAllowed || isIndia) && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.charges,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(PaymentPartners, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 23\n    }\n  })))), /*#__PURE__*/React.createElement(Card, {\n    className: cx(styles.mode),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: cx(styles.cod, {\n      [styles.active]: defaultSwitchManual(values)\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.modeName,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 19\n    }\n  }, \"Manual\"), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(DefaultSwitch, {\n    active: defaultSwitchManual(values),\n    onChange: (e, val) => {\n      const isEmptyConfigured = values.custompayment.configured.length === 0;\n      defaultSwitchManualChange(setFieldValue, val, isEmptyConfigured);\n      toggleManual();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 21\n    }\n  }))), defaultSwitchManual(values) && /*#__PURE__*/React.createElement(React.Fragment, null, (stripeAllowed || payPalAllowed || isIndia) && /*#__PURE__*/React.createElement(Accordion, {\n    label: \"Custom Payments\",\n    openDefault: values.custompayment.configured.length === 0,\n    name: \"custompayment.enabled\",\n    onChange: e => {\n      if (values.custompayment.configured.length === 0 && e) {\n        SnackBar.show('Please add atleast one custom payment', 'error');\n        return;\n      }\n\n      if (values.custompayment.configured.filter(x => x.status === 'live').length === 0 && e) {\n        SnackBar.show('Please add atleast one custom payment', 'error');\n        return;\n      }\n\n      setFieldValue('custompayment.enabled', e);\n      toggleSave();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(CustomPayments, {\n    toggleSave: toggleSave,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 25\n    }\n  })), /*#__PURE__*/React.createElement(Accordion, {\n    label: \"Cash\",\n    name: \"cod.enabled\",\n    onChange: onCodSelect(setFieldValue),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 21\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.kbc,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Kbc, {\n    type: \"enablePayments\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 17\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    ref: buttonRef,\n    className: styles.button,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    fullWidth: true,\n    bordered: false,\n    size: \"large\",\n    label: \"Save\",\n    onClick: async () => {\n      try {\n        await schema.validate(values, {\n          abortEarly: true\n        }); // submit form to show field errors\n\n        submitForm();\n      } catch (e) {\n        if (e.value.custompayment.enabled && e.value.custompayment.configured.length === 0) {\n          SnackBar.show('Please add atleast one custom payment', 'error');\n          return;\n        }\n\n        SnackBar.show('Please add all required fields', 'error');\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 15\n    }\n  })))));\n}\n\n_s(PaymentMode, \"h+NM4MJKcoLovbMSAz81A7DvF+8=\", false, function () {\n  return [useShop, useRefreshShop, useHistory, useLocation, useToggle, useToggle];\n});\n\n_c = PaymentMode;\nPaymentMode.propTypes = {};\nPaymentMode.defaultProps = {};\nexport default PaymentMode;\n\nvar _c;\n\n$RefreshReg$(_c, \"PaymentMode\");","map":{"version":3,"sources":["/home/harish/windo/phoenix/src/containers/profile/paymentMode/PaymentMode.jsx"],"names":["React","useRef","Drawer","Button","Card","Switch","DefaultSwitch","Formik","useRefreshShop","useShop","useToggle","SnackBar","cx","useHistory","useLocation","Becca","Loader","PaymentPartners","isPayPalAllowed","isStripeAllowed","Kbc","EventManager","Accordion","CustomPayments","styles","getInitialValues","schema","PaymentMode","paymentModes","country","accounts","isIndia","toLowerCase","paymentsEnabled","filter","x","enabled","length","refreshShop","history","location","stripeAllowed","payPalAllowed","openOnline","toggleOnline","openManual","toggleManual","buttonRef","defaultSwitchManual","values","cod","custompayment","toggleSave","current","firstElementChild","click","defaultSwitchManualChange","setValue","val","isEmptyConfigured","defaultSwitchOnline","online","defaultSwitchOnlineChange","show","onSubmit","updateShop","emitEvent","state","redirectTo","push","e","showError","hide","onCodSelect","setField","value","drawer","setFieldValue","submitForm","container","main","heading","mode","active","modeName","configured","charges","status","kbc","button","validate","abortEarly","propTypes","defaultProps"],"mappings":"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","sourcesContent":["import React, { useRef } from 'react';\nimport { Drawer } from 'components/shared/Drawer';\nimport {\n  Button, Card\n} from 'phoenix-components';\nimport { Switch as DefaultSwitch } from 'phoenix-components';\nimport { Formik } from 'formik';\nimport {\n  useRefreshShop,\n  useShop\n} from 'contexts/userContext';\nimport { useToggle } from 'hooks/common';\nimport SnackBar from 'services/snackbar';\nimport cx from 'classnames';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport { Becca } from 'api';\nimport Loader from 'services/loader';\nimport { PaymentPartners } from 'containers/lazy';\nimport { isPayPalAllowed, isStripeAllowed } from 'utils/countries';\nimport Kbc from 'components/knowBaseCards/KnowBaseCards.jsx';\nimport EventManager from 'utils/events';\nimport Accordion from './Accordion';\nimport CustomPayments from './CustomPayments';\nimport styles from './PaymentMode.module.css';\nimport { getInitialValues, schema } from './utils';\n\nfunction PaymentMode() {\n  const {\n    paymentModes, country,\n    accounts = []\n  } = useShop();\n  const isIndia = country?.toLowerCase() === 'india';\n  const paymentsEnabled = accounts.filter(x => x.enabled).length > 0;\n  const refreshShop = useRefreshShop();\n  const history = useHistory();\n  const location = useLocation();\n  const stripeAllowed = isStripeAllowed(country);\n  const payPalAllowed = isPayPalAllowed(country);\n  const [openOnline, toggleOnline] = useToggle(false);\n  const [openManual, toggleManual] = useToggle(false);\n  const buttonRef = useRef();\n\n  const defaultSwitchManual = (values) => {\n    if (openManual) {\n      return true;\n    }\n    if (isIndia) {\n      return values.cod.enabled || values.custompayment.enabled;\n    }\n    if (stripeAllowed || payPalAllowed) {\n      return values.cod.enabled || values.custompayment.enabled;\n    }\n    return values.cod.enabled;\n  };\n\n  const toggleSave = () => {\n    if (buttonRef.current) {\n      buttonRef.current.firstElementChild.click();\n    }\n  };\n\n  const defaultSwitchManualChange = (setValue, val, isEmptyConfigured) => {\n    if (isIndia || stripeAllowed || payPalAllowed) {\n      setValue('cod.enabled', val);\n      setValue('custompayment.enabled', val);\n      if (isEmptyConfigured) {\n        setValue('custompayment.enabled', false);\n      }\n      toggleSave();\n      return;\n    }\n\n    setValue('cod.enabled', val);\n    toggleSave();\n  };\n\n  const defaultSwitchOnline = (values) => {\n    if (openOnline) {\n      return true;\n    }\n    if (isIndia || stripeAllowed || payPalAllowed) {\n      return values.online.enabled;\n    }\n    return values.custompayment.enabled;\n  };\n\n  const defaultSwitchOnlineChange = (setValue, val) => {\n    if (isIndia) {\n      setValue('online.enabled', val);\n      toggleSave();\n      return;\n    }\n    if (stripeAllowed || payPalAllowed) {\n      if (!paymentsEnabled && val) {\n        SnackBar.show('Please activate atleast one partner', 'error');\n        return;\n      }\n      setValue('online.enabled', val);\n      toggleSave();\n      return;\n    }\n    setValue('custompayment.enabled', val);\n    toggleSave();\n  };\n\n  const onSubmit = async (values) => {\n    try {\n      Loader.show();\n      await Becca.updateShop({\n        paymentModes: values,\n      });\n      EventManager.emitEvent('payments_enabled');\n      SnackBar.show('Payment settings updated successfully', 'success');\n      refreshShop();\n      if (location?.state?.redirectTo) {\n        history.push(location.state.redirectTo);\n        return;\n      }\n    } catch (e) {\n      SnackBar.showError(e);\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const onCodSelect = (setField) => (value) => {\n    setField('cod.enabled', value);\n    toggleSave();\n  };\n\n  return (\n    <Drawer\n      title=\"Payment Settings\"\n      containerClass={styles.drawer}\n    >\n      <Formik\n        validationSchema={schema}\n        initialValues={getInitialValues(paymentModes)}\n        onSubmit={onSubmit}\n      >\n        {({\n          values,\n          setFieldValue,\n          submitForm\n        }) => (\n          <div className={styles.container}>\n            <div className={styles.main}>\n              <div className={styles.heading}>Choose Payment Modes</div>\n              <Card className={cx(styles.mode)}>\n                <div className={cx(styles.cod, { [styles.active]: defaultSwitchOnline(values) })}>\n                  <div className={styles.modeName}>Online</div>\n                  <div>\n                    <DefaultSwitch\n                      active={defaultSwitchOnline(values)}\n                      onChange={(e, val) => {\n                        defaultSwitchOnlineChange(setFieldValue, val);\n                        toggleOnline();\n                      }}\n                    />\n                  </div>\n                </div>\n                {!stripeAllowed && !payPalAllowed && !isIndia && (\n                  <Accordion\n                    label=\"Direct Payments\"\n                    name=\"custompayment.enabled\"\n                    openDefault={values.custompayment.configured.length === 0}\n                    onChange={(e) => {\n                      if (values.custompayment.configured.length === 0 && !values.cod.enabled && e) {\n                        SnackBar.show('Please add atleast one custom payment', 'error');\n                        return;\n                      }\n                      setFieldValue('custompayment.enabled', e);\n                      toggleSave();\n                    }}\n                  >\n                    <CustomPayments toggleSave={toggleSave} />\n                  </Accordion>\n                )}\n                {(defaultSwitchOnline(values)) && (stripeAllowed || payPalAllowed || isIndia) && (\n                  <>\n                    <div className={styles.charges}>\n                      <PaymentPartners />\n                    </div>\n                  </>\n                )}\n              </Card>\n              <Card className={cx(styles.mode)}>\n                <div className={cx(styles.cod, { [styles.active]: defaultSwitchManual(values) })}>\n                  <div className={styles.modeName}>Manual</div>\n                  <div>\n                    <DefaultSwitch\n                      active={defaultSwitchManual(values)}\n                      onChange={(e, val) => {\n                        const isEmptyConfigured = values.custompayment.configured.length === 0;\n                        defaultSwitchManualChange(setFieldValue, val, isEmptyConfigured);\n                        toggleManual();\n                      }}\n                    />\n                  </div>\n                </div>\n                {defaultSwitchManual(values) && (\n                  <>\n                    {(stripeAllowed || payPalAllowed || isIndia) && (\n                      <Accordion\n                        label=\"Custom Payments\"\n                        openDefault={values.custompayment.configured.length === 0}\n                        name=\"custompayment.enabled\"\n                        onChange={(e) => {\n                          if (values.custompayment.configured.length === 0 && e) {\n                            SnackBar.show('Please add atleast one custom payment', 'error');\n                            return;\n                          }\n                          if (values.custompayment.configured.filter(x => x.status === 'live').length === 0 && e) {\n                            SnackBar.show('Please add atleast one custom payment', 'error');\n                            return;\n                          }\n                          setFieldValue('custompayment.enabled', e);\n                          toggleSave();\n                        }}\n                      >\n                        <CustomPayments toggleSave={toggleSave} />\n                      </Accordion>\n\n                    )}\n                    <Accordion\n                      label=\"Cash\"\n                      name=\"cod.enabled\"\n                      onChange={onCodSelect(setFieldValue)}\n                    >\n                    </Accordion>\n                  </>\n                )}\n              </Card>\n              <div className={styles.kbc}>\n                <Kbc\n                  type=\"enablePayments\"\n                />\n              </div>\n            </div>\n            <div ref={buttonRef} className={styles.button}>\n              <Button\n                fullWidth\n                bordered={false}\n                size=\"large\"\n                label=\"Save\"\n                onClick={async () => {\n                  try {\n                    await schema.validate(values, {\n                      abortEarly: true\n                    });\n                    // submit form to show field errors\n                    submitForm();\n                  } catch (e) {\n                    if (e.value.custompayment.enabled && e.value.custompayment.configured.length === 0) {\n                      SnackBar.show('Please add atleast one custom payment', 'error');\n                      return;\n                    }\n                    SnackBar.show('Please add all required fields', 'error');\n                  }\n                }}\n              />\n            </div>\n          </div>\n        )}\n      </Formik>\n    </Drawer>\n  );\n}\n\nPaymentMode.propTypes = {};\n\nPaymentMode.defaultProps = {};\n\nexport default PaymentMode;\n"]},"metadata":{},"sourceType":"module"}