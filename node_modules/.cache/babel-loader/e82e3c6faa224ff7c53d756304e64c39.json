{"ast":null,"code":"var _jsxFileName = \"/home/harish/windo/phoenix/src/containers/profile/ratings/Ratings.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useRef, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Drawer } from \"../../../components/shared/Drawer\";\nimport reviewIcon from \"../../../assets/images/profile/ratings.svg\";\nimport Info from \"../../../components/info/Info\";\nimport checkIcon from \"../../../assets/images/orders/multi/check.svg\";\nimport unCheckIcon from \"../../../assets/images/orders/multi/uncheck.svg\";\nimport chevronLeftDesk from \"../../../assets/v2/common/chevronPrimaryLeft.svg\";\nimport { useRefreshShop } from \"../../../contexts/userContext\";\nimport { OtherButton } from \"../../../components/products/OtherButton\";\nimport emptyOrder from \"../../../assets/overview/newOrder.svg\";\nimport { StatusSelectionBar } from \"../../../components/shared/StatusSelectionBar\";\nimport { RatingCard } from \"../../../components/products/RatingCard\";\nimport { useDesktop, IsShopRatingsEnabled, IsShopRatingsAutoApproved } from \"../../../contexts\";\nimport SnackBar from \"../../../services/snackbar\";\nimport Loader from \"../../../services/loader\";\nimport { Switch } from 'phoenix-components';\nimport { useInfiniteRatings } from \"../../../hooks/ratings\";\nimport { InfiniteLoader, List, Grid, CellMeasurerCache, CellMeasurer } from 'react-virtualized';\nimport { Becca } from \"../../../api\";\nimport Kbc from \"../../../components/knowBaseCards/KnowBaseCards\";\nimport styles from \"./Ratings.module.css\";\n\nfunction Ratings() {\n  _s();\n\n  var _splitterRef$current;\n\n  const stateList = [{\n    label: 'Products',\n    value: 'sku'\n  }, {\n    label: 'Shop (Coming Soon)',\n    value: 'shop'\n  }];\n  const cache = new CellMeasurerCache({\n    fixedWidth: true,\n    defaultHeight: 250 - 71 - 45\n  });\n  const deskCache = new CellMeasurerCache({\n    defaultHeight: 155,\n    fixedWidth: true\n  });\n  const [type, setType] = useState(stateList[0].value);\n  const history = useHistory();\n  const isDesktop = useDesktop();\n  const splitterRef = useRef();\n  const isShopRatingsEnabled = IsShopRatingsEnabled();\n  const isShopRatingsAutoApproved = IsShopRatingsAutoApproved();\n  const refreshShop = useRefreshShop();\n  const [ratings, loadMore, hasMore,, refresh] = useInfiniteRatings(-1, {\n    createdAt: -1\n  });\n\n  const isLoaded = i => !!ratings[i];\n\n  const rowCount = hasMore ? 10000 : ratings.length;\n  const height = window.screen.height - 78 - 36 - 50;\n  const width = splitterRef === null || splitterRef === void 0 ? void 0 : (_splitterRef$current = splitterRef.current) === null || _splitterRef$current === void 0 ? void 0 : _splitterRef$current.clientWidth;\n  const dHeight = window.screen.height - 90 - 68 - 24 - 68;\n\n  const gotoShareRating = () => {\n    history.push('/manage/createRatingLink');\n  };\n\n  const text = 'Want to enable ratings and reviews on your shop?';\n  const info = 'You can share the rating link with them anytime Or Customers will see \\'Rate the Product\\' option ' + ' once you mark  the order as completed or shipping status as delivered or picked-up.';\n\n  const onUnlive = async (isAutoApprove = false) => {\n    const config = !isAutoApprove ? {\n      ratings: {\n        enabled: !isShopRatingsEnabled,\n        autoApprove: isShopRatingsAutoApproved\n      }\n    } : {\n      ratings: {\n        enabled: isShopRatingsEnabled,\n        autoApprove: !isShopRatingsAutoApproved\n      }\n    };\n    Loader.show();\n\n    try {\n      await Becca.updateShop({\n        config\n      });\n      refreshShop();\n      SnackBar.show('Ratings changes saved successfully', 'success');\n    } catch (e) {\n      SnackBar.showError(e);\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const onStateChange = val => {\n    setType(val);\n  }; // eslint-disable-next-line react/no-multi-comp\n\n\n  const renderItem = item => /*#__PURE__*/React.createElement(CellMeasurer, {\n    cache: cache,\n    columnIndex: 0,\n    key: item.key,\n    rowIndex: item.index,\n    parent: item.parent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 5\n    }\n  }, ({\n    measure,\n    registerChild\n  }) => /*#__PURE__*/React.createElement(\"div\", {\n    ref: registerChild,\n    key: item.key,\n    style: item.style,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(RatingCard, {\n    measure: measure,\n    showProduct: true,\n    rating: ratings[item.index],\n    refresh: refresh,\n    showReviewsLink: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 11\n    }\n  })));\n\n  const renderCell = el => {\n    const showBorder = el.columnIndex === 0;\n    const idx = el.rowIndex * 2 + el.columnIndex;\n\n    if (idx >= ratings.length) {\n      return null;\n    }\n\n    const {\n      style\n    } = el;\n    return /*#__PURE__*/React.createElement(CellMeasurer, {\n      cache: deskCache,\n      columnIndex: el.columnIndex,\n      key: el.key,\n      parent: el.parent,\n      rowIndex: el.rowIndex,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      style: { ...style,\n        width: width / 2\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(RatingCard, {\n      showProduct: true,\n      showBorder: showBorder,\n      rating: ratings[idx],\n      refresh: refresh,\n      showReviewsLink: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 11\n      }\n    })));\n  };\n\n  const onSectionRendered = onRowsRendered => ({\n    columnStartIndex,\n    columnStopIndex,\n    rowStartIndex,\n    rowStopIndex\n  }) => {\n    const startIndex = rowStartIndex * 2 + columnStartIndex;\n    const stopIndex = rowStopIndex * 2 + columnStopIndex;\n    onRowsRendered({\n      startIndex,\n      stopIndex\n    });\n  };\n\n  const body = () => /*#__PURE__*/React.createElement(\"div\", {\n    id: \"scroll\",\n    className: styles.sdContent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.flex,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.reviewHead,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.ratingView,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: reviewIcon,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.text,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 13\n    }\n  }, text), /*#__PURE__*/React.createElement(Switch, {\n    active: isShopRatingsEnabled,\n    onChange: () => onUnlive(false),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.subC,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: isShopRatingsAutoApproved ? checkIcon : unCheckIcon,\n    className: styles.imgC,\n    alt: \"\",\n    onClick: () => onUnlive(true),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 13\n    }\n  }), \"Approve ratings automatically\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.hText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 11\n    }\n  }, \"Check this box to automatically approve product ratings submitted by customers. You can always disable a rating that has been automatically approved.\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.shareSection,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(OtherButton, {\n    onClick: gotoShareRating,\n    label: \"Share Ratings Link\",\n    open: false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flexCenter fullWidth\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Kbc, {\n    type: \"ratingsAndReview\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(Info, {\n    text: info,\n    title: \"Info\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(StatusSelectionBar, {\n    className: styles.tab,\n    tabClassName: styles.tabClassName,\n    activeClass: styles.tabActive,\n    items: stateList,\n    onChange: onStateChange,\n    active: type,\n    seperator: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    ref: splitterRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 7\n    }\n  }), (ratings === null || ratings === void 0 ? void 0 : ratings.length) === 0 && /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.emptyOrders,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: emptyOrder,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.emptyProductText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 13\n    }\n  }, 'You haven\\'t received any reviews yet!')), /*#__PURE__*/React.createElement(InfiniteLoader, {\n    loadMoreRows: loadMore,\n    isRowLoaded: isLoaded,\n    rowCount: rowCount,\n    minimumBatchSize: 10,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 7\n    }\n  }, ({\n    onRowsRendered,\n    registerChild\n  }) => isDesktop ? /*#__PURE__*/React.createElement(Grid, {\n    onSectionRendered: onSectionRendered(onRowsRendered),\n    ref: registerChild,\n    deferredMeasurementCache: deskCache,\n    cellRenderer: renderCell,\n    columnCount: 2,\n    overscanColumnCount: 0,\n    overscanRowCount: 2,\n    columnWidth: width / 2,\n    height: dHeight,\n    rowCount: Math.ceil(rowCount / 2),\n    rowHeight: deskCache.rowHeight,\n    width: width,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 11\n    }\n  }) : /*#__PURE__*/React.createElement(List, {\n    height: height,\n    onRowsRendered: onRowsRendered,\n    ref: registerChild,\n    rowCount: ratings.length,\n    deferredMeasurementCache: cache,\n    rowHeight: cache.rowHeight,\n    rowRenderer: renderItem,\n    width: window.screen.width - 32,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 13\n    }\n  })));\n\n  if (isDesktop) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.desktopContainer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 276,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      onClick: history.goBack,\n      className: styles.maintitle,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      className: styles.backIconForDesktop,\n      src: chevronLeftDesk,\n      alt: \"\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 279,\n        columnNumber: 11\n      }\n    }, \"\\xA0\"), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 280,\n        columnNumber: 11\n      }\n    }, \"\\xA0\"), \"Reviews\"), body());\n  }\n\n  return /*#__PURE__*/React.createElement(Drawer, {\n    className: styles.section,\n    title: \"Reviews\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 5\n    }\n  }, body());\n}\n\n_s(Ratings, \"EgakJ22YKcDW5X/NZ0tUyt4HSG0=\", false, function () {\n  return [useHistory, useDesktop, useRefreshShop, useInfiniteRatings];\n});\n\n_c = Ratings;\nexport default Ratings;\n\nvar _c;\n\n$RefreshReg$(_c, \"Ratings\");","map":{"version":3,"sources":["/home/harish/windo/phoenix/src/containers/profile/ratings/Ratings.jsx"],"names":["React","useRef","useState","useHistory","Drawer","Info","useRefreshShop","OtherButton","StatusSelectionBar","RatingCard","useDesktop","IsShopRatingsEnabled","IsShopRatingsAutoApproved","SnackBar","Loader","Switch","useInfiniteRatings","InfiniteLoader","List","Grid","CellMeasurerCache","CellMeasurer","Becca","Kbc","styles","Ratings","stateList","label","value","cache","fixedWidth","defaultHeight","deskCache","type","setType","history","isDesktop","splitterRef","isShopRatingsEnabled","isShopRatingsAutoApproved","refreshShop","ratings","loadMore","hasMore","refresh","createdAt","isLoaded","i","rowCount","length","height","window","screen","width","current","clientWidth","dHeight","gotoShareRating","push","text","info","onUnlive","isAutoApprove","config","enabled","autoApprove","show","updateShop","e","showError","hide","onStateChange","val","renderItem","item","key","index","parent","measure","registerChild","style","renderCell","el","showBorder","columnIndex","idx","rowIndex","onSectionRendered","onRowsRendered","columnStartIndex","columnStopIndex","rowStartIndex","rowStopIndex","startIndex","stopIndex","body","sdContent","flex","reviewHead","ratingView","reviewIcon","subC","checkIcon","unCheckIcon","imgC","hText","shareSection","tab","tabClassName","tabActive","emptyOrders","emptyOrder","emptyProductText","Math","ceil","rowHeight","desktopContainer","goBack","maintitle","backIconForDesktop","chevronLeftDesk","section"],"mappings":"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","sourcesContent":["import React, { useRef, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Drawer } from 'components/shared/Drawer';\nimport reviewIcon from 'assets/images/profile/ratings.svg';\nimport Info from 'components/info/Info';\nimport checkIcon from 'assets/images/orders/multi/check.svg';\nimport unCheckIcon from 'assets/images/orders/multi/uncheck.svg';\nimport chevronLeftDesk from 'assets/v2/common/chevronPrimaryLeft.svg';\nimport { useRefreshShop } from 'contexts/userContext';\nimport { OtherButton } from 'components/products/OtherButton';\nimport emptyOrder from 'assets/overview/newOrder.svg';\nimport { StatusSelectionBar } from 'components/shared/StatusSelectionBar';\nimport { RatingCard } from 'components/products/RatingCard';\nimport {\n  useDesktop, IsShopRatingsEnabled, IsShopRatingsAutoApproved\n} from 'contexts';\nimport SnackBar from 'services/snackbar';\nimport Loader from 'services/loader';\nimport {\n  Switch\n} from 'phoenix-components';\nimport { useInfiniteRatings } from 'hooks/ratings';\nimport {\n  InfiniteLoader, List, Grid, CellMeasurerCache, CellMeasurer\n} from 'react-virtualized';\nimport { Becca } from 'api';\nimport Kbc from 'components/knowBaseCards/KnowBaseCards';\nimport styles from './Ratings.module.css';\n\nfunction Ratings() {\n  const stateList = [\n    {\n      label: 'Products',\n      value: 'sku',\n    },\n    {\n      label: 'Shop (Coming Soon)',\n      value: 'shop',\n    }\n  ];\n\n  const cache = new CellMeasurerCache({\n    fixedWidth: true,\n    defaultHeight: 250 - 71 - 45\n  });\n\n  const deskCache = new CellMeasurerCache({\n    defaultHeight: 155,\n    fixedWidth: true,\n  });\n\n  const [type, setType] = useState(stateList[0].value);\n  const history = useHistory();\n  const isDesktop = useDesktop();\n  const splitterRef = useRef();\n  const isShopRatingsEnabled = IsShopRatingsEnabled();\n  const isShopRatingsAutoApproved = IsShopRatingsAutoApproved();\n  const refreshShop = useRefreshShop();\n\n  const [ratings, loadMore, hasMore, , refresh] = useInfiniteRatings(-1, {\n    createdAt: -1,\n  });\n\n  const isLoaded = i => !!ratings[i];\n\n  const rowCount = hasMore ? 10000 : ratings.length;\n\n  const height = window.screen.height - 78 - 36 - 50;\n\n  const width = splitterRef?.current?.clientWidth;\n\n  const dHeight = window.screen.height - 90 - 68 - 24 - 68;\n\n  const gotoShareRating = () => {\n    history.push('/manage/createRatingLink');\n  };\n\n  const text = 'Want to enable ratings and reviews on your shop?';\n  const info = 'You can share the rating link with them anytime Or Customers will see \\'Rate the Product\\' option '\n    + ' once you mark  the order as completed or shipping status as delivered or picked-up.';\n\n  const onUnlive = async (isAutoApprove = false) => {\n    const config = !isAutoApprove ? {\n      ratings: {\n        enabled: !isShopRatingsEnabled,\n        autoApprove: isShopRatingsAutoApproved\n      }\n    } : {\n      ratings: {\n        enabled: isShopRatingsEnabled,\n        autoApprove: !isShopRatingsAutoApproved\n      }\n    };\n    Loader.show();\n    try {\n      await Becca.updateShop({\n        config,\n      });\n      refreshShop();\n      SnackBar.show('Ratings changes saved successfully', 'success');\n    } catch (e) {\n      SnackBar.showError(e);\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const onStateChange = (val) => {\n    setType(val);\n  };\n\n  // eslint-disable-next-line react/no-multi-comp\n  const renderItem = (item) => (\n    <CellMeasurer\n      cache={cache}\n      columnIndex={0}\n      key={item.key}\n      rowIndex={item.index}\n      parent={item.parent}>\n      {({ measure, registerChild }) => (\n        <div ref={registerChild} key={item.key} style={item.style}>\n          <RatingCard\n            measure={measure}\n            showProduct={true}\n            rating={ratings[item.index]}\n            refresh={refresh}\n            showReviewsLink={true}\n          />\n        </div>\n      )}\n    </CellMeasurer>\n  );\n\n  const renderCell = (el) => {\n    const showBorder = el.columnIndex === 0;\n    const idx = el.rowIndex * 2 + el.columnIndex;\n    if (idx >= ratings.length) {\n      return null;\n    }\n    const { style } = el;\n    return (\n      <CellMeasurer\n        cache={deskCache}\n        columnIndex={el.columnIndex}\n        key={el.key}\n        parent={el.parent}\n        rowIndex={el.rowIndex}\n      >\n        <div\n          style={{\n            ...style,\n            width: width / 2,\n          }}>\n          <RatingCard\n            showProduct={true}\n            showBorder={showBorder}\n            rating={ratings[idx]}\n            refresh={refresh}\n            showReviewsLink={true}\n          />\n        </div>\n      </CellMeasurer>\n    );\n  };\n\n  const onSectionRendered = (onRowsRendered) => ({\n    columnStartIndex,\n    columnStopIndex,\n    rowStartIndex,\n    rowStopIndex\n  }) => {\n    const startIndex = rowStartIndex * 2 + columnStartIndex;\n    const stopIndex = rowStopIndex * 2 + columnStopIndex;\n\n    onRowsRendered({\n      startIndex,\n      stopIndex\n    });\n  };\n\n  const body = () => (\n    <div id=\"scroll\" className={styles.sdContent}>\n      <div className={styles.flex}>\n        <div className={styles.reviewHead}>\n          <div className={styles.ratingView}>\n            <img src={reviewIcon} alt=\"\" />\n            <div className={styles.text}>{text}</div>\n            <Switch active={isShopRatingsEnabled} onChange={() => onUnlive(false)} />\n          </div>\n          <div className={styles.subC}>\n            <img\n              src={isShopRatingsAutoApproved ? checkIcon : unCheckIcon}\n              className={styles.imgC}\n              alt=\"\"\n              onClick={() => onUnlive(true)}\n            />\n            Approve ratings automatically\n          </div>\n          <div className={styles.hText}>\n            Check this box to automatically approve product ratings\n            submitted by customers. You can always disable\n            a rating that has been automatically approved.\n          </div>\n        </div>\n      </div>\n      <div className={styles.shareSection}>\n        <OtherButton onClick={gotoShareRating} label=\"Share Ratings Link\" open={false} />\n      </div>\n      <div className=\"flexCenter fullWidth\">\n        <Kbc type=\"ratingsAndReview\" />\n      </div>\n      <Info text={info} title=\"Info\" />\n      <StatusSelectionBar\n        className={styles.tab}\n        tabClassName={styles.tabClassName}\n        activeClass={styles.tabActive}\n        items={stateList}\n        onChange={onStateChange}\n        active={type}\n        seperator={true}\n      />\n      <div ref={splitterRef}></div>\n      {\n        ratings?.length === 0 && (\n          <div className={styles.emptyOrders}>\n            <img src={emptyOrder} alt=\"\" />\n            <div className={styles.emptyProductText}>\n              {'You haven\\'t received any reviews yet!'}\n            </div>\n          </div>\n        )\n      }\n      <InfiniteLoader\n        loadMoreRows={loadMore}\n        isRowLoaded={isLoaded}\n        rowCount={rowCount}\n        minimumBatchSize={10}\n      >\n        {({\n          onRowsRendered,\n          registerChild\n        }) => (isDesktop ? (\n          <Grid\n            onSectionRendered={onSectionRendered(onRowsRendered)}\n            ref={registerChild}\n            deferredMeasurementCache={deskCache}\n            cellRenderer={renderCell}\n            columnCount={2}\n            overscanColumnCount={0}\n            overscanRowCount={2}\n            columnWidth={(width) / 2}\n            height={dHeight}\n            rowCount={Math.ceil(rowCount / 2)}\n            rowHeight={deskCache.rowHeight}\n            width={width}\n          />\n        )\n          : (\n            <List\n              height={height}\n              onRowsRendered={onRowsRendered}\n              ref={registerChild}\n              rowCount={ratings.length}\n              deferredMeasurementCache={cache}\n              rowHeight={cache.rowHeight}\n              rowRenderer={renderItem}\n              width={window.screen.width - 32}\n            />\n          ))}\n      </InfiniteLoader>\n    </div>\n  );\n\n  if (isDesktop) {\n    return (\n      <div className={styles.desktopContainer}>\n        <div onClick={history.goBack} className={styles.maintitle}>\n          <img className={styles.backIconForDesktop} src={chevronLeftDesk} alt=\"\" />\n          <div>&nbsp;</div>\n          <div>&nbsp;</div>\n          Reviews\n        </div>\n        {body()}\n      </div>\n    );\n  }\n\n  return (\n    <Drawer\n      className={styles.section}\n      title=\"Reviews\"\n    >\n      {body()}\n    </Drawer>\n  );\n}\nexport default Ratings;\n"]},"metadata":{},"sourceType":"module"}