{"ast":null,"code":"import CONFIG from \"../config\";\nimport * as Sentry from '@sentry/react';\n\nfunction setGlobalData(data = {}) {\n  window.__WINDO_DATA = { ...data,\n    env: CONFIG.ENV\n  };\n}\n\nfunction patchGlobalData(data = {}) {\n  if (!window.__WINDO_DATA) {\n    window.__WINDO_DATA = {};\n  }\n\n  window.__WINDO_DATA = {\n    env: CONFIG.ENV,\n    ...window.__WINDO_DATA,\n    ...data\n  };\n}\n\nfunction resetGlobalData() {\n  window.__WINDO_DATA = {};\n}\n\nfunction emitEvent(name, data = {}) {\n  try {\n    if (!window.dataLayer) {\n      window.dataLayer = [];\n    }\n\n    window.dataLayer.push({\n      event: 'custom_event',\n      eventLabel: name,\n      eventData: data\n    });\n  } catch (e) {\n    Sentry.captureException(e);\n  }\n}\n\nasync function loadMoEngage(data) {\n  if (window._Moengage) {\n    return window._Moengage;\n  }\n\n  if (!window.moe) {\n    const script = document.createElement('script'); // eslint-disable-next-line max-len\n\n    script.innerHTML = '(function(i,s,o,g,r,a,m,n){i.moengage_object=r;t={};q=function(f){return function(){(i.moengage_q=i.moengage_q||[]).push({f:f,a:arguments})}};f=[\\'track_event\\',\\'add_user_attribute\\',\\'add_first_name\\',\\'add_last_name\\',\\'add_email\\',\\'add_mobile\\',\\'add_user_name\\',\\'add_gender\\',\\'add_birthday\\',\\'destroy_session\\',\\'add_unique_user_id\\',\\'moe_events\\',\\'call_web_push\\',\\'track\\',\\'location_type_attribute\\'],h={onsite:[\"getData\",\"registerCallback\"]};for(k in f){t[f[k]]=q(f[k])}for(k in h)for(l in h[k]){null==t[k]&&(t[k]={}),t[k][h[k][l]]=q(k+\".\"+h[k][l])}a=s.createElement(o);m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);i.moe=i.moe||function(){n=arguments[0];return t};a.onload=function(){if(n){i[r]=moe(n)}}})(window,document,\\'script\\',\\'https://cdn.moengage.com/webpush/moe_webSdk.min.latest.js\\',\\'Moengage\\')';\n    window.document.body.appendChild(script);\n  }\n\n  return new Promise(resolve => {\n    const interval = setInterval(() => {\n      if (window.moe) {\n        clearInterval(interval);\n        window._Moengage = window.moe({\n          app_id: CONFIG.MOENGAGE.id,\n          debug_logs: CONFIG.ENV === 'production' ? 0 : 1\n        });\n\n        window._Moengage.add_user_name(data.name);\n\n        if (data.email) {\n          window._Moengage.add_email(data.email);\n        }\n\n        if (data.phone) {\n          window._Moengage.add_mobile(data.phone);\n        }\n\n        if (data.id) {\n          window._Moengage.add_unique_user_id(data.id);\n        }\n\n        resolve();\n      }\n    }, 1000);\n  });\n}\n\nasync function initMoEngageWeb(data) {\n  try {\n    await loadMoEngage(data);\n  } catch (e) {\n    Sentry.captureException(e);\n  }\n}\n\nasync function trackMoengageEvent(event, data) {\n  try {\n    if (window._Moengage) {\n      const moe = window._Moengage;\n      await moe.track_event(event, data);\n    }\n  } catch (e) {\n    Sentry.captureException(e);\n  }\n}\n\nasync function waitForFB() {\n  return new Promise(resolve => {\n    if (!window.fbq) {\n      let counter = 0;\n      const interval = setInterval(() => {\n        if (counter > 10) {\n          clearInterval(interval);\n          resolve();\n          return;\n        }\n\n        if (window.fbq) {\n          clearInterval(interval);\n          resolve();\n        }\n\n        counter++;\n      }, 1000);\n    } else {\n      resolve();\n    }\n  });\n}\n\nasync function initFbWeb(data) {\n  await waitForFB();\n\n  if (window.fbq) {\n    if (data.email) {\n      window.fbq('init', CONFIG.FB.id, {\n        em: data.email\n      });\n    }\n  }\n}\n\nasync function trackFbEvent(event, data) {\n  try {\n    if (window.fbq) {\n      window.fbq('trackCustom', event, data);\n    }\n  } catch (e) {\n    Sentry.captureException(e);\n  }\n}\n\nasync function initializeWebEvents(data) {\n  await initMoEngageWeb(data);\n  await initFbWeb(data);\n\n  window._logEvent = async (event, eventData) => {\n    await Promise.all([trackMoengageEvent(event, eventData), trackFbEvent(event, eventData)]);\n  };\n}\n\nconst EventManager = {\n  setGlobalData,\n  resetGlobalData,\n  patchGlobalData,\n  emitEvent,\n  initializeWebEvents\n};\nexport default EventManager;","map":{"version":3,"sources":["/home/harish/windo/phoenix/src/utils/events.js"],"names":["CONFIG","Sentry","setGlobalData","data","window","__WINDO_DATA","env","ENV","patchGlobalData","resetGlobalData","emitEvent","name","dataLayer","push","event","eventLabel","eventData","e","captureException","loadMoEngage","_Moengage","moe","script","document","createElement","innerHTML","body","appendChild","Promise","resolve","interval","setInterval","clearInterval","app_id","MOENGAGE","id","debug_logs","add_user_name","email","add_email","phone","add_mobile","add_unique_user_id","initMoEngageWeb","trackMoengageEvent","track_event","waitForFB","fbq","counter","initFbWeb","FB","em","trackFbEvent","initializeWebEvents","_logEvent","all","EventManager"],"mappings":"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","sourcesContent":["import CONFIG from 'config';\nimport * as Sentry from '@sentry/react';\n\nfunction setGlobalData(data = {}) {\n  window.__WINDO_DATA = {\n    ...data,\n    env: CONFIG.ENV,\n  };\n}\n\nfunction patchGlobalData(data = {}) {\n  if (!window.__WINDO_DATA) {\n    window.__WINDO_DATA = {};\n  }\n  window.__WINDO_DATA = {\n    env: CONFIG.ENV,\n    ...window.__WINDO_DATA,\n    ...data,\n  };\n}\n\nfunction resetGlobalData() {\n  window.__WINDO_DATA = {};\n}\n\nfunction emitEvent(name, data = {}) {\n  try {\n    if (!window.dataLayer) {\n      window.dataLayer = [];\n    }\n    window.dataLayer.push({\n      event: 'custom_event',\n      eventLabel: name,\n      eventData: data,\n    });\n  } catch (e) {\n    Sentry.captureException(e);\n  }\n}\n\nasync function loadMoEngage(data) {\n  if (window._Moengage) {\n    return window._Moengage;\n  }\n\n  if (!window.moe) {\n    const script = document.createElement('script');\n    // eslint-disable-next-line max-len\n    script.innerHTML = '(function(i,s,o,g,r,a,m,n){i.moengage_object=r;t={};q=function(f){return function(){(i.moengage_q=i.moengage_q||[]).push({f:f,a:arguments})}};f=[\\'track_event\\',\\'add_user_attribute\\',\\'add_first_name\\',\\'add_last_name\\',\\'add_email\\',\\'add_mobile\\',\\'add_user_name\\',\\'add_gender\\',\\'add_birthday\\',\\'destroy_session\\',\\'add_unique_user_id\\',\\'moe_events\\',\\'call_web_push\\',\\'track\\',\\'location_type_attribute\\'],h={onsite:[\"getData\",\"registerCallback\"]};for(k in f){t[f[k]]=q(f[k])}for(k in h)for(l in h[k]){null==t[k]&&(t[k]={}),t[k][h[k][l]]=q(k+\".\"+h[k][l])}a=s.createElement(o);m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);i.moe=i.moe||function(){n=arguments[0];return t};a.onload=function(){if(n){i[r]=moe(n)}}})(window,document,\\'script\\',\\'https://cdn.moengage.com/webpush/moe_webSdk.min.latest.js\\',\\'Moengage\\')';\n    window.document.body.appendChild(script);\n  }\n\n  return new Promise(resolve => {\n    const interval = setInterval(() => {\n      if (window.moe) {\n        clearInterval(interval);\n        window._Moengage = window.moe({\n          app_id: CONFIG.MOENGAGE.id,\n          debug_logs: CONFIG.ENV === 'production' ? 0 : 1,\n        });\n        window._Moengage.add_user_name(data.name);\n        if (data.email) {\n          window._Moengage.add_email(data.email);\n        }\n        if (data.phone) {\n          window._Moengage.add_mobile(data.phone);\n        }\n        if (data.id) {\n          window._Moengage.add_unique_user_id(data.id);\n        }\n        resolve();\n      }\n    }, 1000);\n  });\n}\n\nasync function initMoEngageWeb(data) {\n  try {\n    await loadMoEngage(data);\n  } catch (e) {\n    Sentry.captureException(e);\n  }\n}\n\nasync function trackMoengageEvent(event, data) {\n  try {\n    if (window._Moengage) {\n      const moe = window._Moengage;\n      await moe.track_event(event, data);\n    }\n  } catch (e) {\n    Sentry.captureException(e);\n  }\n}\n\nasync function waitForFB() {\n  return new Promise(resolve => {\n    if (!window.fbq) {\n      let counter = 0;\n      const interval = setInterval(() => {\n        if (counter > 10) {\n          clearInterval(interval);\n          resolve();\n          return;\n        }\n        if (window.fbq) {\n          clearInterval(interval);\n          resolve();\n        }\n        counter++;\n      }, 1000);\n    } else {\n      resolve();\n    }\n  });\n}\n\nasync function initFbWeb(data) {\n  await waitForFB();\n  if (window.fbq) {\n    if (data.email) {\n      window.fbq('init', CONFIG.FB.id, {\n        em: data.email,\n      });\n    }\n  }\n}\n\nasync function trackFbEvent(event, data) {\n  try {\n    if (window.fbq) {\n      window.fbq('trackCustom', event, data);\n    }\n  } catch (e) {\n    Sentry.captureException(e);\n  }\n}\n\nasync function initializeWebEvents(data) {\n  await initMoEngageWeb(data);\n  await initFbWeb(data);\n\n  window._logEvent = async (event, eventData) => {\n    await Promise.all([\n      trackMoengageEvent(event, eventData),\n      trackFbEvent(event, eventData)\n    ]);\n  };\n}\n\nconst EventManager = {\n  setGlobalData,\n  resetGlobalData,\n  patchGlobalData,\n  emitEvent,\n  initializeWebEvents,\n};\n\nexport default EventManager;\n"]},"metadata":{},"sourceType":"module"}