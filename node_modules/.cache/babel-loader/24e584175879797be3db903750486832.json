{"ast":null,"code":"var _jsxFileName = \"/home/harish/windo/phoenix/src/components/common/FilesUploader.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport uploadIcon from \"../../assets/images/uploader.svg\";\nimport { FilesPreview } from \"./FilesPreview\";\nimport { validateFiles } from \"../../utils/files\";\nimport Snackbar from \"../../services/snackbar\";\nimport Loader from \"../../services/loader\";\nimport { Becca } from \"../../api\";\nimport { inParallelWithLimit } from \"../../utils/parallel\";\nimport styles from \"./FilesUploader.module.css\";\nexport function FilesUploader({\n  files,\n  onChange,\n  accept,\n  isMulti,\n  label,\n  showCover,\n  disabled,\n  showClose,\n  bottomLabel,\n  showImg\n}) {\n  _s();\n\n  const [err, setErr] = useState();\n\n  const removeFile = index => {\n    onChange(files.filter((_i, idx) => idx !== index));\n  };\n\n  const onCoverSelect = index => {\n    const otherItems = files.filter((_i, idx) => idx !== index);\n    const selectedItems = files.filter((_i, idx) => idx === index);\n    onChange([...selectedItems, ...otherItems]);\n  };\n\n  const onFileAdd = async e => {\n    Loader.show();\n    setErr(false);\n\n    try {\n      const validatedFiles = validateFiles([...e.target.files]);\n\n      if (validatedFiles.length) {\n        let uploaded = await inParallelWithLimit(validatedFiles, 3, async file => {\n          const fileName = file === null || file === void 0 ? void 0 : file.name;\n\n          try {\n            const payload = new FormData();\n            const ext = fileName.split('.').pop();\n            payload.append('name', fileName);\n            payload.append('purpose', 'shop');\n            payload.append('type', 'file');\n            payload.append('file', file);\n            const {\n              url\n            } = await Becca.uploadAsset(payload);\n            return {\n              name: fileName,\n              ext,\n              url\n            };\n          } catch (e) {\n            Snackbar.show(`${fileName} failed to upload `, 'error');\n          }\n        });\n        uploaded = uploaded.filter(x => x).map(x => ({\n          type: 'file',\n          name: x.name,\n          value: x.url\n        }));\n        const allFiles = [];\n\n        if (isMulti) {\n          allFiles.push(...files);\n        }\n\n        allFiles.push(...uploaded);\n        onChange(allFiles);\n      }\n\n      if (files.length === 0) {\n        setErr(true);\n      }\n    } catch (e) {\n      Snackbar.showError(e);\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.row,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 11\n    }\n  }, files.map((file, idx) => /*#__PURE__*/React.createElement(FilesPreview, {\n    key: idx,\n    onDelete: removeFile,\n    index: idx,\n    item: file,\n    showClose: showClose,\n    showImg: showImg,\n    onCoverClick: showCover ? onCoverSelect : null,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 15\n    }\n  }))), files.length === 0 || isMulti ? /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.filesUploader,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.label,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 15\n    }\n  }, label), /*#__PURE__*/React.createElement(\"img\", {\n    className: styles.image,\n    src: uploadIcon,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"file\",\n    className: styles.input,\n    accept: accept,\n    onChange: onFileAdd,\n    multiple: isMulti,\n    disabled: disabled,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 15\n    }\n  })) : '', files.length === 0 && bottomLabel && /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.bottomLabelContainer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    className: styles.bottomLabel,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 15\n    }\n  }, bottomLabel)))), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.info,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 7\n    }\n  }, \"Maximum file upload size is 50MB\"), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }\n  }, err));\n}\n\n_s(FilesUploader, \"dvTAPZ0csr/cvzEoorV5GEDaeKY=\");\n\n_c = FilesUploader;\nFilesUploader.propTypes = {\n  files: PropTypes.array.isRequired,\n  onChange: PropTypes.func.isRequired,\n  accept: PropTypes.string,\n  isMulti: PropTypes.bool,\n  showCover: PropTypes.bool,\n  label: PropTypes.string,\n  bottomLabel: PropTypes.string,\n  disabled: PropTypes.bool,\n  showClose: PropTypes.bool,\n  showImg: PropTypes.bool\n};\nFilesUploader.defaultProps = {\n  accept: '',\n  isMulti: false,\n  showCover: false,\n  label: 'Upload multiple photos or videos of your product',\n  bottomLabel: '',\n  disabled: false,\n  showClose: true,\n  showImg: true\n};\n\nvar _c;\n\n$RefreshReg$(_c, \"FilesUploader\");","map":{"version":3,"sources":["/home/harish/windo/phoenix/src/components/common/FilesUploader.jsx"],"names":["React","useState","PropTypes","FilesPreview","validateFiles","Snackbar","Loader","Becca","inParallelWithLimit","styles","FilesUploader","files","onChange","accept","isMulti","label","showCover","disabled","showClose","bottomLabel","showImg","err","setErr","removeFile","index","filter","_i","idx","onCoverSelect","otherItems","selectedItems","onFileAdd","e","show","validatedFiles","target","length","uploaded","file","fileName","name","payload","FormData","ext","split","pop","append","url","uploadAsset","x","map","type","value","allFiles","push","showError","hide","container","row","filesUploader","image","uploadIcon","input","bottomLabelContainer","info","propTypes","array","isRequired","func","string","bool","defaultProps"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport uploadIcon from 'assets/images/uploader.svg';\nimport { FilesPreview } from 'components/common/FilesPreview';\nimport { validateFiles } from 'utils/files';\nimport Snackbar from 'services/snackbar';\nimport Loader from 'services/loader';\nimport { Becca } from 'api';\nimport { inParallelWithLimit } from 'utils/parallel';\nimport styles from './FilesUploader.module.css';\n\nexport function FilesUploader({\n  files,\n  onChange,\n  accept,\n  isMulti,\n  label,\n  showCover,\n  disabled,\n  showClose,\n  bottomLabel,\n  showImg\n}) {\n  const [err, setErr] = useState();\n\n  const removeFile = (index) => {\n    onChange(files.filter((_i, idx) => idx !== index));\n  };\n\n  const onCoverSelect = (index) => {\n    const otherItems = files.filter((_i, idx) => idx !== index);\n    const selectedItems = files.filter((_i, idx) => idx === index);\n    onChange([...selectedItems, ...otherItems]);\n  };\n\n  const onFileAdd = async (e) => {\n    Loader.show();\n    setErr(false);\n    try {\n      const validatedFiles = validateFiles([...e.target.files]);\n      if (validatedFiles.length) {\n        let uploaded = await inParallelWithLimit(validatedFiles, 3, async file => {\n          const fileName = file?.name;\n          try {\n            const payload = new FormData();\n            const ext = fileName.split('.')\n              .pop();\n            payload.append('name', fileName);\n            payload.append('purpose', 'shop');\n            payload.append('type', 'file');\n            payload.append('file', file);\n            const { url } = await Becca.uploadAsset(payload);\n            return {\n              name: fileName,\n              ext,\n              url,\n            };\n          } catch (e) {\n            Snackbar.show(`${fileName} failed to upload `, 'error');\n          }\n        });\n\n        uploaded = uploaded.filter(x => x)\n          .map((x) => ({\n            type: 'file',\n            name: x.name,\n            value: x.url,\n          }));\n        const allFiles = [];\n        if (isMulti) {\n          allFiles.push(...files);\n        }\n        allFiles.push(...uploaded);\n        onChange(allFiles);\n      }\n      if (files.length === 0) {\n        setErr(true);\n      }\n    } catch (e) {\n      Snackbar.showError(e);\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  return (\n    <>\n      <label>\n        <div className={styles.container}>\n          <div className={styles.row}>\n            {files.map((file, idx) => (\n              <FilesPreview\n                key={idx}\n                onDelete={removeFile}\n                index={idx}\n                item={file}\n                showClose={showClose}\n                showImg={showImg}\n                onCoverClick={showCover ? onCoverSelect : null}\n              />\n            ))}\n          </div>\n          {files.length === 0 || isMulti ? (\n            <div className={styles.filesUploader}>\n              <div className={styles.label}>\n                {label}\n              </div>\n              <img className={styles.image} src={uploadIcon} alt=\"\" />\n              <input\n                type=\"file\"\n                className={styles.input}\n                accept={accept}\n                onChange={onFileAdd}\n                multiple={isMulti}\n                disabled={disabled}\n              />\n            </div>\n          ) : ''}\n          {files.length === 0 && bottomLabel && (\n            <div className={styles.bottomLabelContainer}>\n              <label className={styles.bottomLabel}>\n                {bottomLabel}\n              </label>\n            </div>\n          )}\n        </div>\n      </label>\n      <div className={styles.info}>\n        Maximum file upload size is 50MB\n      </div>\n      <div>{err}</div>\n    </>\n  );\n}\n\nFilesUploader.propTypes = {\n  files: PropTypes.array.isRequired,\n  onChange: PropTypes.func.isRequired,\n  accept: PropTypes.string,\n  isMulti: PropTypes.bool,\n  showCover: PropTypes.bool,\n  label: PropTypes.string,\n  bottomLabel: PropTypes.string,\n  disabled: PropTypes.bool,\n  showClose: PropTypes.bool,\n  showImg: PropTypes.bool\n};\n\nFilesUploader.defaultProps = {\n  accept: '',\n  isMulti: false,\n  showCover: false,\n  label: 'Upload multiple photos or videos of your product',\n  bottomLabel: '',\n  disabled: false,\n  showClose: true,\n  showImg: true\n};\n"]},"metadata":{},"sourceType":"module"}