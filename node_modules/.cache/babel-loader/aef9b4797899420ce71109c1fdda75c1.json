{"ast":null,"code":"function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nimport { getCurrentScript, setLabel, merge, extend, isUndefined } from './utils';\nimport EventHandler from './event-handler';\nimport { CONFIG_CHANGE, LOCAL_CONFIG_KEY } from './constants';\n\nfunction getConfigFromScript() {\n  var script = getCurrentScript();\n  var config = getDataAttributesFromNode(script);\n  return config;\n}\n\nfunction getDataAttributesFromNode(node) {\n  if (!node) {\n    return {};\n  }\n\n  var dataAttrs = {};\n  var dataRegex = /^data-([\\w-]+)$/;\n  var attrs = node.attributes;\n\n  for (var i = 0; i < attrs.length; i++) {\n    var attr = attrs[i];\n\n    if (dataRegex.test(attr.nodeName)) {\n      var key = attr.nodeName.match(dataRegex)[1];\n      var camelCasedkey = key.split('-').map(function (value, index) {\n        return index > 0 ? value.charAt(0).toUpperCase() + value.substring(1) : value;\n      }).join('');\n      dataAttrs[camelCasedkey] = attr.value || attr.nodeValue;\n    }\n  }\n\n  return dataAttrs;\n}\n\nvar Config = function () {\n  function Config() {\n    this.config = {\n      serviceName: '',\n      serviceVersion: '',\n      environment: '',\n      serverUrl: 'http://localhost:8200',\n      serverUrlPrefix: '',\n      active: true,\n      instrument: true,\n      disableInstrumentations: [],\n      logLevel: 'warn',\n      breakdownMetrics: false,\n      ignoreTransactions: [],\n      eventsLimit: 80,\n      queueLimit: -1,\n      flushInterval: 500,\n      distributedTracing: true,\n      distributedTracingOrigins: [],\n      distributedTracingHeaderName: 'traceparent',\n      pageLoadTraceId: '',\n      pageLoadSpanId: '',\n      pageLoadSampled: false,\n      pageLoadTransactionName: '',\n      propagateTracestate: false,\n      transactionSampleRate: 1.0,\n      centralConfig: false,\n      monitorLongtasks: true,\n      apiVersion: 2,\n      context: {},\n      session: false,\n      apmRequest: null\n    };\n    this.events = new EventHandler();\n    this.filters = [];\n    this.version = '';\n  }\n\n  var _proto = Config.prototype;\n\n  _proto.init = function init() {\n    var scriptData = getConfigFromScript();\n    this.setConfig(scriptData);\n  };\n\n  _proto.setVersion = function setVersion(version) {\n    this.version = version;\n  };\n\n  _proto.addFilter = function addFilter(cb) {\n    if (typeof cb !== 'function') {\n      throw new Error('Argument to must be function');\n    }\n\n    this.filters.push(cb);\n  };\n\n  _proto.applyFilters = function applyFilters(data) {\n    for (var i = 0; i < this.filters.length; i++) {\n      data = this.filters[i](data);\n\n      if (!data) {\n        return;\n      }\n    }\n\n    return data;\n  };\n\n  _proto.get = function get(key) {\n    return key.split('.').reduce(function (obj, objKey) {\n      return obj && obj[objKey];\n    }, this.config);\n  };\n\n  _proto.setUserContext = function setUserContext(userContext) {\n    if (userContext === void 0) {\n      userContext = {};\n    }\n\n    var context = {};\n    var _userContext = userContext,\n        id = _userContext.id,\n        username = _userContext.username,\n        email = _userContext.email;\n\n    if (typeof id === 'number' || typeof id === 'string') {\n      context.id = id;\n    }\n\n    if (typeof username === 'string') {\n      context.username = username;\n    }\n\n    if (typeof email === 'string') {\n      context.email = email;\n    }\n\n    this.config.context.user = extend(this.config.context.user || {}, context);\n  };\n\n  _proto.setCustomContext = function setCustomContext(customContext) {\n    if (customContext === void 0) {\n      customContext = {};\n    }\n\n    this.config.context.custom = extend(this.config.context.custom || {}, customContext);\n  };\n\n  _proto.addLabels = function addLabels(tags) {\n    var _this = this;\n\n    if (!this.config.context.tags) {\n      this.config.context.tags = {};\n    }\n\n    var keys = Object.keys(tags);\n    keys.forEach(function (k) {\n      return setLabel(k, tags[k], _this.config.context.tags);\n    });\n  };\n\n  _proto.setConfig = function setConfig(properties) {\n    if (properties === void 0) {\n      properties = {};\n    }\n\n    var _properties = properties,\n        transactionSampleRate = _properties.transactionSampleRate,\n        serverUrl = _properties.serverUrl;\n\n    if (serverUrl) {\n      properties.serverUrl = serverUrl.replace(/\\/+$/, '');\n    }\n\n    if (!isUndefined(transactionSampleRate)) {\n      if (transactionSampleRate < 0.0001 && transactionSampleRate > 0) {\n        transactionSampleRate = 0.0001;\n      }\n\n      properties.transactionSampleRate = Math.round(transactionSampleRate * 10000) / 10000;\n    }\n\n    merge(this.config, properties);\n    this.events.send(CONFIG_CHANGE, [this.config]);\n  };\n\n  _proto.validate = function validate(properties) {\n    if (properties === void 0) {\n      properties = {};\n    }\n\n    var requiredKeys = ['serviceName', 'serverUrl'];\n    var errors = {\n      missing: [],\n      invalid: []\n    };\n    Object.keys(properties).forEach(function (key) {\n      if (requiredKeys.indexOf(key) !== -1 && !properties[key]) {\n        errors.missing.push(key);\n      }\n    });\n\n    if (properties.serviceName && !/^[a-zA-Z0-9 _-]+$/.test(properties.serviceName)) {\n      errors.invalid.push({\n        key: 'serviceName',\n        value: properties.serviceName,\n        allowed: 'a-z, A-Z, 0-9, _, -, <space>'\n      });\n    }\n\n    var sampleRate = properties.transactionSampleRate;\n\n    if (typeof sampleRate !== 'undefined' && (typeof sampleRate !== 'number' || isNaN(sampleRate) || sampleRate < 0 || sampleRate > 1)) {\n      errors.invalid.push({\n        key: 'transactionSampleRate',\n        value: sampleRate,\n        allowed: 'Number between 0 and 1'\n      });\n    }\n\n    return errors;\n  };\n\n  _proto.getLocalConfig = function getLocalConfig() {\n    var storage = sessionStorage;\n\n    if (this.config.session) {\n      storage = localStorage;\n    }\n\n    var config = storage.getItem(LOCAL_CONFIG_KEY);\n\n    if (config) {\n      return JSON.parse(config);\n    }\n  };\n\n  _proto.setLocalConfig = function setLocalConfig(config, merge) {\n    if (config) {\n      if (merge) {\n        var prevConfig = this.getLocalConfig();\n        config = _extends({}, prevConfig, config);\n      }\n\n      var storage = sessionStorage;\n\n      if (this.config.session) {\n        storage = localStorage;\n      }\n\n      storage.setItem(LOCAL_CONFIG_KEY, JSON.stringify(config));\n    }\n  };\n\n  return Config;\n}();\n\nexport default Config;","map":{"version":3,"sources":["/home/harish/windo/phoenix/node_modules/@elastic/apm-rum-core/dist/es/common/config-service.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","getCurrentScript","setLabel","merge","extend","isUndefined","EventHandler","CONFIG_CHANGE","LOCAL_CONFIG_KEY","getConfigFromScript","script","config","getDataAttributesFromNode","node","dataAttrs","dataRegex","attrs","attributes","attr","test","nodeName","match","camelCasedkey","split","map","value","index","charAt","toUpperCase","substring","join","nodeValue","Config","serviceName","serviceVersion","environment","serverUrl","serverUrlPrefix","active","instrument","disableInstrumentations","logLevel","breakdownMetrics","ignoreTransactions","eventsLimit","queueLimit","flushInterval","distributedTracing","distributedTracingOrigins","distributedTracingHeaderName","pageLoadTraceId","pageLoadSpanId","pageLoadSampled","pageLoadTransactionName","propagateTracestate","transactionSampleRate","centralConfig","monitorLongtasks","apiVersion","context","session","apmRequest","events","filters","version","_proto","init","scriptData","setConfig","setVersion","addFilter","cb","Error","push","applyFilters","data","get","reduce","obj","objKey","setUserContext","userContext","_userContext","id","username","email","user","setCustomContext","customContext","custom","addLabels","tags","_this","keys","forEach","k","properties","_properties","replace","Math","round","send","validate","requiredKeys","errors","missing","invalid","indexOf","allowed","sampleRate","isNaN","getLocalConfig","storage","sessionStorage","localStorage","getItem","JSON","parse","setLocalConfig","prevConfig","setItem","stringify"],"mappings":"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","sourcesContent":["function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport { getCurrentScript, setLabel, merge, extend, isUndefined } from './utils';\nimport EventHandler from './event-handler';\nimport { CONFIG_CHANGE, LOCAL_CONFIG_KEY } from './constants';\n\nfunction getConfigFromScript() {\n  var script = getCurrentScript();\n  var config = getDataAttributesFromNode(script);\n  return config;\n}\n\nfunction getDataAttributesFromNode(node) {\n  if (!node) {\n    return {};\n  }\n\n  var dataAttrs = {};\n  var dataRegex = /^data-([\\w-]+)$/;\n  var attrs = node.attributes;\n\n  for (var i = 0; i < attrs.length; i++) {\n    var attr = attrs[i];\n\n    if (dataRegex.test(attr.nodeName)) {\n      var key = attr.nodeName.match(dataRegex)[1];\n      var camelCasedkey = key.split('-').map(function (value, index) {\n        return index > 0 ? value.charAt(0).toUpperCase() + value.substring(1) : value;\n      }).join('');\n      dataAttrs[camelCasedkey] = attr.value || attr.nodeValue;\n    }\n  }\n\n  return dataAttrs;\n}\n\nvar Config = function () {\n  function Config() {\n    this.config = {\n      serviceName: '',\n      serviceVersion: '',\n      environment: '',\n      serverUrl: 'http://localhost:8200',\n      serverUrlPrefix: '',\n      active: true,\n      instrument: true,\n      disableInstrumentations: [],\n      logLevel: 'warn',\n      breakdownMetrics: false,\n      ignoreTransactions: [],\n      eventsLimit: 80,\n      queueLimit: -1,\n      flushInterval: 500,\n      distributedTracing: true,\n      distributedTracingOrigins: [],\n      distributedTracingHeaderName: 'traceparent',\n      pageLoadTraceId: '',\n      pageLoadSpanId: '',\n      pageLoadSampled: false,\n      pageLoadTransactionName: '',\n      propagateTracestate: false,\n      transactionSampleRate: 1.0,\n      centralConfig: false,\n      monitorLongtasks: true,\n      apiVersion: 2,\n      context: {},\n      session: false,\n      apmRequest: null\n    };\n    this.events = new EventHandler();\n    this.filters = [];\n    this.version = '';\n  }\n\n  var _proto = Config.prototype;\n\n  _proto.init = function init() {\n    var scriptData = getConfigFromScript();\n    this.setConfig(scriptData);\n  };\n\n  _proto.setVersion = function setVersion(version) {\n    this.version = version;\n  };\n\n  _proto.addFilter = function addFilter(cb) {\n    if (typeof cb !== 'function') {\n      throw new Error('Argument to must be function');\n    }\n\n    this.filters.push(cb);\n  };\n\n  _proto.applyFilters = function applyFilters(data) {\n    for (var i = 0; i < this.filters.length; i++) {\n      data = this.filters[i](data);\n\n      if (!data) {\n        return;\n      }\n    }\n\n    return data;\n  };\n\n  _proto.get = function get(key) {\n    return key.split('.').reduce(function (obj, objKey) {\n      return obj && obj[objKey];\n    }, this.config);\n  };\n\n  _proto.setUserContext = function setUserContext(userContext) {\n    if (userContext === void 0) {\n      userContext = {};\n    }\n\n    var context = {};\n    var _userContext = userContext,\n        id = _userContext.id,\n        username = _userContext.username,\n        email = _userContext.email;\n\n    if (typeof id === 'number' || typeof id === 'string') {\n      context.id = id;\n    }\n\n    if (typeof username === 'string') {\n      context.username = username;\n    }\n\n    if (typeof email === 'string') {\n      context.email = email;\n    }\n\n    this.config.context.user = extend(this.config.context.user || {}, context);\n  };\n\n  _proto.setCustomContext = function setCustomContext(customContext) {\n    if (customContext === void 0) {\n      customContext = {};\n    }\n\n    this.config.context.custom = extend(this.config.context.custom || {}, customContext);\n  };\n\n  _proto.addLabels = function addLabels(tags) {\n    var _this = this;\n\n    if (!this.config.context.tags) {\n      this.config.context.tags = {};\n    }\n\n    var keys = Object.keys(tags);\n    keys.forEach(function (k) {\n      return setLabel(k, tags[k], _this.config.context.tags);\n    });\n  };\n\n  _proto.setConfig = function setConfig(properties) {\n    if (properties === void 0) {\n      properties = {};\n    }\n\n    var _properties = properties,\n        transactionSampleRate = _properties.transactionSampleRate,\n        serverUrl = _properties.serverUrl;\n\n    if (serverUrl) {\n      properties.serverUrl = serverUrl.replace(/\\/+$/, '');\n    }\n\n    if (!isUndefined(transactionSampleRate)) {\n      if (transactionSampleRate < 0.0001 && transactionSampleRate > 0) {\n        transactionSampleRate = 0.0001;\n      }\n\n      properties.transactionSampleRate = Math.round(transactionSampleRate * 10000) / 10000;\n    }\n\n    merge(this.config, properties);\n    this.events.send(CONFIG_CHANGE, [this.config]);\n  };\n\n  _proto.validate = function validate(properties) {\n    if (properties === void 0) {\n      properties = {};\n    }\n\n    var requiredKeys = ['serviceName', 'serverUrl'];\n    var errors = {\n      missing: [],\n      invalid: []\n    };\n    Object.keys(properties).forEach(function (key) {\n      if (requiredKeys.indexOf(key) !== -1 && !properties[key]) {\n        errors.missing.push(key);\n      }\n    });\n\n    if (properties.serviceName && !/^[a-zA-Z0-9 _-]+$/.test(properties.serviceName)) {\n      errors.invalid.push({\n        key: 'serviceName',\n        value: properties.serviceName,\n        allowed: 'a-z, A-Z, 0-9, _, -, <space>'\n      });\n    }\n\n    var sampleRate = properties.transactionSampleRate;\n\n    if (typeof sampleRate !== 'undefined' && (typeof sampleRate !== 'number' || isNaN(sampleRate) || sampleRate < 0 || sampleRate > 1)) {\n      errors.invalid.push({\n        key: 'transactionSampleRate',\n        value: sampleRate,\n        allowed: 'Number between 0 and 1'\n      });\n    }\n\n    return errors;\n  };\n\n  _proto.getLocalConfig = function getLocalConfig() {\n    var storage = sessionStorage;\n\n    if (this.config.session) {\n      storage = localStorage;\n    }\n\n    var config = storage.getItem(LOCAL_CONFIG_KEY);\n\n    if (config) {\n      return JSON.parse(config);\n    }\n  };\n\n  _proto.setLocalConfig = function setLocalConfig(config, merge) {\n    if (config) {\n      if (merge) {\n        var prevConfig = this.getLocalConfig();\n        config = _extends({}, prevConfig, config);\n      }\n\n      var storage = sessionStorage;\n\n      if (this.config.session) {\n        storage = localStorage;\n      }\n\n      storage.setItem(LOCAL_CONFIG_KEY, JSON.stringify(config));\n    }\n  };\n\n  return Config;\n}();\n\nexport default Config;"]},"metadata":{},"sourceType":"module"}