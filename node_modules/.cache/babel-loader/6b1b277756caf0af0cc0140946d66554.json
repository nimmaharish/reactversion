{"ast":null,"code":"var _jsxFileName = \"/home/harish/windo/phoenix/src/components/orders/PaymentLink.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { Formik } from 'formik';\nimport cx from 'classnames';\nimport { Dialog } from '@material-ui/core';\nimport { Button, Clickable, FormikInput } from 'phoenix-components';\nimport { Switch } from 'phoenix-components/lib/formik';\nimport { LinkBar } from 'phoenix-components/lib/containers';\nimport editIcon from \"../../assets/overview/edit.svg\";\nimport generateIcon from \"../../assets/logos/generate.svg\";\nimport closeIcon from \"../../assets/images/orders/list/close.svg\";\nimport { useCustomDomain, useDesktop, useIsOnCustomDomain, useShop } from \"../../contexts\";\nimport { useNonConfirmedAmount, useOrder } from \"../../contexts/orderContext\";\nimport { useToggle } from \"../../hooks/common\";\nimport SnackBar from \"../../services/snackbar\";\nimport Loader from \"../../services/loader\";\nimport { Factory } from \"../../api\";\nimport { Drawer } from \"../shared/Drawer\";\nimport { SideDrawer } from \"../shared/SideDrawer\";\nimport { FooterButton } from \"../common/FooterButton\";\nimport { share } from \"../../utils\";\nimport DeviceUtils from \"../../utils/deviceUtils\";\nimport { getInitialValues, marshalData, schema } from \"./paymentLinkUtils\";\nimport styles from \"./PaymentLink.module.css\";\nexport default function PaymentLink() {\n  _s();\n\n  const order = useOrder();\n  const [link, setLink] = useState(order === null || order === void 0 ? void 0 : order.paymentLink);\n  const [linkAlert, toggleLinkAlert] = useToggle();\n  const shop = useShop();\n  const isDesktop = useDesktop();\n  const due = useNonConfirmedAmount();\n  const [paymentLinkFormOpen, togglePaymentLinkForm] = useToggle();\n  const isCustomDomain = useIsOnCustomDomain();\n  const domain = useCustomDomain();\n  const url = `https://${isCustomDomain ? domain : 'mywindo.shop'}/pay/${link === null || link === void 0 ? void 0 : link._id}`;\n\n  const generatePaymentLink = async values => {\n    const mode = values.modes.find(x => x.enabled);\n\n    if (!mode) {\n      SnackBar.showError('Please select at least one mode');\n      return;\n    }\n\n    try {\n      Loader.show();\n      setLink(await Factory.generatePaymentLink({\n        orderId: order === null || order === void 0 ? void 0 : order._id,\n        modes: marshalData(values)\n      }));\n      toggleLinkAlert();\n    } catch (e) {\n      SnackBar.showError(e);\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const copyToClipboard = () => {\n    DeviceUtils.copy(url);\n    SnackBar.show('Shop URL Copied !!!');\n  };\n\n  const shareToUser = e => {\n    e.stopPropagation();\n    e.preventDefault();\n    share(`Hello\n    Your order tracking link for order id #${order === null || order === void 0 ? void 0 : order.orderId} is\n\n    url\n\n    Thank you\n    ${shop === null || shop === void 0 ? void 0 : shop.name}`);\n  };\n\n  const Component = isDesktop ? SideDrawer : Drawer;\n\n  if (due === 0) {\n    return null;\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: cx(styles.container, {\n      [styles.linkExists]: link\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }\n  }, link ? /*#__PURE__*/React.createElement(\"div\", {\n    className: cx('flexBetween', styles.shareSection),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 13\n    }\n  }, \"Share payment link\"), /*#__PURE__*/React.createElement(\"img\", {\n    src: editIcon,\n    alt: \"editIcon\",\n    onClick: togglePaymentLinkForm,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 13\n    }\n  })) : null, link ? /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.shareLinkSection,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.linkbarContainer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(LinkBar, {\n    url: url,\n    onCopy: copyToClipboard,\n    onClick: shareToUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 15\n    }\n  }))) : /*#__PURE__*/React.createElement(\"div\", {\n    className: cx('flexCenter', styles.btnContainer),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    className: styles.generateIcon,\n    src: generateIcon,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    className: styles.text,\n    onClick: togglePaymentLinkForm,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 13\n    }\n  }, \"Generate payment link\"))), /*#__PURE__*/React.createElement(Dialog, {\n    PaperProps: {\n      classes: {\n        root: styles.dialog\n      }\n    },\n    maxWidth: isDesktop ? 'xs' : 'md',\n    open: linkAlert,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: cx('flexEnd', styles.closeIcon),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Clickable, {\n    onClick: () => {\n      togglePaymentLinkForm();\n      toggleLinkAlert();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: closeIcon,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(\"p\", {\n    className: styles.paymentText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 9\n    }\n  }, \"Your payment link as been created. You can share the payment link with your user.\"), /*#__PURE__*/React.createElement(\"p\", {\n    className: styles.sharePaymentHeading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 9\n    }\n  }, \"Share Payment Link\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.shareLinkSection,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.paymentLinkbar,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(LinkBar, {\n    url: url,\n    onCopy: copyToClipboard,\n    onClick: shareToUser,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(\"p\", {\n    className: styles.paymentText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 9\n    }\n  }, \"you can always share the payment link later in order detail screen\")), paymentLinkFormOpen && /*#__PURE__*/React.createElement(Component, {\n    title: \"Generate Payment Link\",\n    backButton: true,\n    onClose: togglePaymentLinkForm,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Formik, {\n    validationSchema: schema,\n    initialValues: getInitialValues(shop, link),\n    onSubmit: generatePaymentLink,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 13\n    }\n  }, ({\n    values,\n    submitForm\n  }) => {\n    var _values$modes;\n\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.paymentsContainer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 23\n      }\n    }, \"Enter the amount\"), /*#__PURE__*/React.createElement(FormikInput, {\n      variant: \"outlined\",\n      name: \"payable\",\n      type: \"text\",\n      label: \"Enter Amount\",\n      placeholder: \"e.g. INR 100\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 23\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 23\n      }\n    }, \"Payment Mode\"), values === null || values === void 0 ? void 0 : (_values$modes = values.modes) === null || _values$modes === void 0 ? void 0 : _values$modes.map((payment, index) => /*#__PURE__*/React.createElement(\"div\", {\n      key: index,\n      className: cx('flexBetween', styles.paymentCard),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 27\n      }\n    }, payment === null || payment === void 0 ? void 0 : payment.name), /*#__PURE__*/React.createElement(Switch, {\n      name: `modes[${index}].enabled`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 27\n      }\n    })))), isDesktop ? /*#__PURE__*/React.createElement(Button, {\n      fullWidth: true,\n      bordered: false,\n      label: \"Generate Payment Link\",\n      className: styles.button,\n      onClick: submitForm,\n      variant: \"outlined\",\n      size: \"small\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 23\n      }\n    }) : /*#__PURE__*/React.createElement(FooterButton, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      fullWidth: true,\n      bordered: false,\n      label: \"Generate Payment Link\",\n      className: styles.button,\n      onClick: submitForm,\n      variant: \"outlined\",\n      size: \"small\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 25\n      }\n    }))));\n  })));\n}\n\n_s(PaymentLink, \"3TEPFg61zEMHHhbx4D1F+f/tgh4=\", false, function () {\n  return [useOrder, useToggle, useShop, useDesktop, useNonConfirmedAmount, useToggle, useIsOnCustomDomain, useCustomDomain];\n});\n\n_c = PaymentLink;\n\nvar _c;\n\n$RefreshReg$(_c, \"PaymentLink\");","map":{"version":3,"sources":["/home/harish/windo/phoenix/src/components/orders/PaymentLink.jsx"],"names":["React","useState","Formik","cx","Dialog","Button","Clickable","FormikInput","Switch","LinkBar","useCustomDomain","useDesktop","useIsOnCustomDomain","useShop","useNonConfirmedAmount","useOrder","useToggle","SnackBar","Loader","Factory","Drawer","SideDrawer","FooterButton","share","DeviceUtils","getInitialValues","marshalData","schema","styles","PaymentLink","order","link","setLink","paymentLink","linkAlert","toggleLinkAlert","shop","isDesktop","due","paymentLinkFormOpen","togglePaymentLinkForm","isCustomDomain","domain","url","_id","generatePaymentLink","values","mode","modes","find","x","enabled","showError","show","orderId","e","hide","copyToClipboard","copy","shareToUser","stopPropagation","preventDefault","name","Component","container","linkExists","shareSection","editIcon","shareLinkSection","linkbarContainer","btnContainer","generateIcon","text","classes","root","dialog","closeIcon","paymentText","sharePaymentHeading","paymentLinkbar","submitForm","paymentsContainer","map","payment","index","paymentCard","button"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport { Formik } from 'formik';\nimport cx from 'classnames';\nimport { Dialog } from '@material-ui/core';\nimport { Button, Clickable, FormikInput } from 'phoenix-components';\nimport { Switch } from 'phoenix-components/lib/formik';\nimport { LinkBar } from 'phoenix-components/lib/containers';\nimport editIcon from 'assets/overview/edit.svg';\nimport generateIcon from 'assets/logos/generate.svg';\nimport closeIcon from 'assets/images/orders/list/close.svg';\nimport {\n  useCustomDomain, useDesktop, useIsOnCustomDomain, useShop\n} from 'contexts';\nimport { useNonConfirmedAmount, useOrder } from 'contexts/orderContext';\nimport { useToggle } from 'hooks/common';\nimport SnackBar from 'services/snackbar';\nimport Loader from 'services/loader';\nimport { Factory } from 'api';\nimport { Drawer } from 'components/shared/Drawer';\nimport { SideDrawer } from 'components/shared/SideDrawer';\nimport { FooterButton } from 'components/common/FooterButton';\nimport { share } from 'utils';\nimport DeviceUtils from 'utils/deviceUtils';\nimport { getInitialValues, marshalData, schema } from './paymentLinkUtils';\nimport styles from './PaymentLink.module.css';\n\nexport default function PaymentLink() {\n  const order = useOrder();\n  const [link, setLink] = useState(order?.paymentLink);\n  const [linkAlert, toggleLinkAlert] = useToggle();\n  const shop = useShop();\n  const isDesktop = useDesktop();\n  const due = useNonConfirmedAmount();\n  const [paymentLinkFormOpen, togglePaymentLinkForm] = useToggle();\n  const isCustomDomain = useIsOnCustomDomain();\n  const domain = useCustomDomain();\n\n  const url = `https://${isCustomDomain ? domain : 'mywindo.shop'}/pay/${link?._id}`;\n\n  const generatePaymentLink = async (values) => {\n    const mode = values.modes.find(x => x.enabled);\n    if (!mode) {\n      SnackBar.showError('Please select at least one mode');\n      return;\n    }\n    try {\n      Loader.show();\n      setLink(await Factory.generatePaymentLink({\n        orderId: order?._id,\n        modes: marshalData(values)\n      }));\n      toggleLinkAlert();\n    } catch (e) {\n      SnackBar.showError(e);\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const copyToClipboard = () => {\n    DeviceUtils.copy(url);\n    SnackBar.show('Shop URL Copied !!!');\n  };\n\n  const shareToUser = e => {\n    e.stopPropagation();\n    e.preventDefault();\n    share(`Hello\n    Your order tracking link for order id #${order?.orderId} is\n\n    url\n\n    Thank you\n    ${shop?.name}`);\n  };\n\n  const Component = isDesktop ? SideDrawer : Drawer;\n\n  if (due === 0) {\n    return null;\n  }\n\n  return (\n    <>\n      <div className={cx(styles.container, { [styles.linkExists]: link })}>\n        {link ? (\n          <div className={cx('flexBetween', styles.shareSection)}>\n            <p>Share payment link</p>\n            <img src={editIcon} alt=\"editIcon\" onClick={togglePaymentLinkForm} />\n          </div>\n        ) : null}\n        {link ? (\n          <div className={styles.shareLinkSection}>\n            <div className={styles.linkbarContainer}>\n              <LinkBar url={url} onCopy={copyToClipboard} onClick={shareToUser} />\n            </div>\n          </div>\n        ) : (\n          <div className={cx('flexCenter', styles.btnContainer)}>\n            <img className={styles.generateIcon} src={generateIcon} alt=\"\" />\n            <p className={styles.text} onClick={togglePaymentLinkForm}>Generate payment link</p>\n          </div>\n        )}\n      </div>\n      <Dialog\n        PaperProps={{\n          classes: {\n            root: styles.dialog,\n          }\n        }}\n        maxWidth={isDesktop ? 'xs' : 'md'}\n        open={linkAlert}>\n        <div className={cx('flexEnd', styles.closeIcon)}>\n          <Clickable\n            onClick={() => {\n              togglePaymentLinkForm();\n              toggleLinkAlert();\n            }}>\n            <img src={closeIcon} alt=\"\" />\n          </Clickable>\n        </div>\n        <p className={styles.paymentText}>\n          Your payment link as been created. You can share the payment link with your user.\n        </p>\n        <p className={styles.sharePaymentHeading}>Share Payment Link</p>\n        <div className={styles.shareLinkSection}>\n          <div className={styles.paymentLinkbar}>\n            <LinkBar url={url} onCopy={copyToClipboard} onClick={shareToUser} />\n          </div>\n        </div>\n        <p className={styles.paymentText}>\n          you can always share the payment link later in order\n          detail screen\n        </p>\n      </Dialog>\n      {\n        paymentLinkFormOpen && (\n          <Component\n            title=\"Generate Payment Link\"\n            backButton\n            onClose={togglePaymentLinkForm}>\n            <Formik\n              validationSchema={schema}\n              initialValues={getInitialValues(shop, link)}\n              onSubmit={generatePaymentLink}>\n              {({\n                values,\n                submitForm,\n              }) => (\n                <>\n                  <div className={styles.paymentsContainer}>\n                    <div>\n                      <p>Enter the amount</p>\n                      <FormikInput\n                        variant=\"outlined\"\n                        name=\"payable\"\n                        type=\"text\"\n                        label=\"Enter Amount\"\n                        placeholder=\"e.g. INR 100\" />\n                      <p>Payment Mode</p>\n                      {values?.modes?.map((payment, index) => (\n                        <div key={index} className={cx('flexBetween', styles.paymentCard)}>\n                          <p>{payment?.name}</p>\n                          <Switch\n                            name={`modes[${index}].enabled`}\n                          />\n                        </div>\n                      ))}\n                    </div>\n                    {isDesktop ? (\n                      <Button\n                        fullWidth\n                        bordered={false}\n                        label=\"Generate Payment Link\"\n                        className={styles.button}\n                        onClick={submitForm}\n                        variant=\"outlined\"\n                        size=\"small\"\n                      />\n                    ) : (\n                      <FooterButton>\n                        <Button\n                          fullWidth\n                          bordered={false}\n                          label=\"Generate Payment Link\"\n                          className={styles.button}\n                          onClick={submitForm}\n                          variant=\"outlined\"\n                          size=\"small\"\n                        />\n                      </FooterButton>\n                    )}\n                  </div>\n                </>\n              )}\n            </Formik>\n          </Component>\n        )\n      }\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}