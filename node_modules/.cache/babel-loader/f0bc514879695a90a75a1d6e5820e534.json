{"ast":null,"code":"var _excluded = [\"tags\"];\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nimport { Url } from './url';\nimport { PAGE_LOAD, NAVIGATION } from './constants';\nimport { getServerTimingInfo, PERF, isPerfTimelineSupported } from './utils';\nvar LEFT_SQUARE_BRACKET = 91;\nvar RIGHT_SQUARE_BRACKET = 93;\nvar EXTERNAL = 'external';\nvar RESOURCE = 'resource';\nvar HARD_NAVIGATION = 'hard-navigation';\n\nfunction getPortNumber(port, protocol) {\n  if (port === '') {\n    port = protocol === 'http:' ? '80' : protocol === 'https:' ? '443' : '';\n  }\n\n  return port;\n}\n\nfunction getResponseContext(perfTimingEntry) {\n  var transferSize = perfTimingEntry.transferSize,\n      encodedBodySize = perfTimingEntry.encodedBodySize,\n      decodedBodySize = perfTimingEntry.decodedBodySize,\n      serverTiming = perfTimingEntry.serverTiming;\n  var respContext = {\n    transfer_size: transferSize,\n    encoded_body_size: encodedBodySize,\n    decoded_body_size: decodedBodySize\n  };\n  var serverTimingStr = getServerTimingInfo(serverTiming);\n\n  if (serverTimingStr) {\n    respContext.headers = {\n      'server-timing': serverTimingStr\n    };\n  }\n\n  return respContext;\n}\n\nfunction getDestination(parsedUrl) {\n  var port = parsedUrl.port,\n      protocol = parsedUrl.protocol,\n      hostname = parsedUrl.hostname;\n  var portNumber = getPortNumber(port, protocol);\n  var ipv6Hostname = hostname.charCodeAt(0) === LEFT_SQUARE_BRACKET && hostname.charCodeAt(hostname.length - 1) === RIGHT_SQUARE_BRACKET;\n  var address = hostname;\n\n  if (ipv6Hostname) {\n    address = hostname.slice(1, -1);\n  }\n\n  return {\n    service: {\n      resource: hostname + ':' + portNumber,\n      name: '',\n      type: ''\n    },\n    address: address,\n    port: Number(portNumber)\n  };\n}\n\nfunction getResourceContext(data) {\n  var entry = data.entry,\n      url = data.url;\n  var parsedUrl = new Url(url);\n  var destination = getDestination(parsedUrl);\n  return {\n    http: {\n      url: url,\n      response: getResponseContext(entry)\n    },\n    destination: destination\n  };\n}\n\nfunction getExternalContext(data) {\n  var url = data.url,\n      method = data.method,\n      target = data.target,\n      response = data.response;\n  var parsedUrl = new Url(url);\n  var destination = getDestination(parsedUrl);\n  var context = {\n    http: {\n      method: method,\n      url: parsedUrl.href\n    },\n    destination: destination\n  };\n  var statusCode;\n\n  if (target && typeof target.status !== 'undefined') {\n    statusCode = target.status;\n  } else if (response) {\n    statusCode = response.status;\n  }\n\n  context.http.status_code = statusCode;\n  return context;\n}\n\nfunction getNavigationContext(data) {\n  var url = data.url;\n  var parsedUrl = new Url(url);\n  var destination = getDestination(parsedUrl);\n  return {\n    destination: destination\n  };\n}\n\nexport function getPageContext() {\n  return {\n    page: {\n      referer: document.referrer,\n      url: location.href\n    }\n  };\n}\nexport function addSpanContext(span, data) {\n  if (!data) {\n    return;\n  }\n\n  var type = span.type;\n  var context;\n\n  switch (type) {\n    case EXTERNAL:\n      context = getExternalContext(data);\n      break;\n\n    case RESOURCE:\n      context = getResourceContext(data);\n      break;\n\n    case HARD_NAVIGATION:\n      context = getNavigationContext(data);\n      break;\n  }\n\n  span.addContext(context);\n}\nexport function addTransactionContext(transaction, _temp) {\n  var _ref = _temp === void 0 ? {} : _temp,\n      tags = _ref.tags,\n      configContext = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  var pageContext = getPageContext();\n  var responseContext = {};\n\n  if (transaction.type === PAGE_LOAD && isPerfTimelineSupported()) {\n    var entries = PERF.getEntriesByType(NAVIGATION);\n\n    if (entries && entries.length > 0) {\n      responseContext = {\n        response: getResponseContext(entries[0])\n      };\n    }\n  }\n\n  transaction.addContext(pageContext, responseContext, configContext);\n}","map":{"version":3,"sources":["/home/harish/windo/phoenix/node_modules/@elastic/apm-rum-core/dist/es/common/context.js"],"names":["_excluded","_objectWithoutPropertiesLoose","source","excluded","target","sourceKeys","Object","keys","key","i","length","indexOf","Url","PAGE_LOAD","NAVIGATION","getServerTimingInfo","PERF","isPerfTimelineSupported","LEFT_SQUARE_BRACKET","RIGHT_SQUARE_BRACKET","EXTERNAL","RESOURCE","HARD_NAVIGATION","getPortNumber","port","protocol","getResponseContext","perfTimingEntry","transferSize","encodedBodySize","decodedBodySize","serverTiming","respContext","transfer_size","encoded_body_size","decoded_body_size","serverTimingStr","headers","getDestination","parsedUrl","hostname","portNumber","ipv6Hostname","charCodeAt","address","slice","service","resource","name","type","Number","getResourceContext","data","entry","url","destination","http","response","getExternalContext","method","context","href","statusCode","status","status_code","getNavigationContext","getPageContext","page","referer","document","referrer","location","addSpanContext","span","addContext","addTransactionContext","transaction","_temp","_ref","tags","configContext","pageContext","responseContext","entries","getEntriesByType"],"mappings":"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","sourcesContent":["var _excluded = [\"tags\"];\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport { Url } from './url';\nimport { PAGE_LOAD, NAVIGATION } from './constants';\nimport { getServerTimingInfo, PERF, isPerfTimelineSupported } from './utils';\nvar LEFT_SQUARE_BRACKET = 91;\nvar RIGHT_SQUARE_BRACKET = 93;\nvar EXTERNAL = 'external';\nvar RESOURCE = 'resource';\nvar HARD_NAVIGATION = 'hard-navigation';\n\nfunction getPortNumber(port, protocol) {\n  if (port === '') {\n    port = protocol === 'http:' ? '80' : protocol === 'https:' ? '443' : '';\n  }\n\n  return port;\n}\n\nfunction getResponseContext(perfTimingEntry) {\n  var transferSize = perfTimingEntry.transferSize,\n      encodedBodySize = perfTimingEntry.encodedBodySize,\n      decodedBodySize = perfTimingEntry.decodedBodySize,\n      serverTiming = perfTimingEntry.serverTiming;\n  var respContext = {\n    transfer_size: transferSize,\n    encoded_body_size: encodedBodySize,\n    decoded_body_size: decodedBodySize\n  };\n  var serverTimingStr = getServerTimingInfo(serverTiming);\n\n  if (serverTimingStr) {\n    respContext.headers = {\n      'server-timing': serverTimingStr\n    };\n  }\n\n  return respContext;\n}\n\nfunction getDestination(parsedUrl) {\n  var port = parsedUrl.port,\n      protocol = parsedUrl.protocol,\n      hostname = parsedUrl.hostname;\n  var portNumber = getPortNumber(port, protocol);\n  var ipv6Hostname = hostname.charCodeAt(0) === LEFT_SQUARE_BRACKET && hostname.charCodeAt(hostname.length - 1) === RIGHT_SQUARE_BRACKET;\n  var address = hostname;\n\n  if (ipv6Hostname) {\n    address = hostname.slice(1, -1);\n  }\n\n  return {\n    service: {\n      resource: hostname + ':' + portNumber,\n      name: '',\n      type: ''\n    },\n    address: address,\n    port: Number(portNumber)\n  };\n}\n\nfunction getResourceContext(data) {\n  var entry = data.entry,\n      url = data.url;\n  var parsedUrl = new Url(url);\n  var destination = getDestination(parsedUrl);\n  return {\n    http: {\n      url: url,\n      response: getResponseContext(entry)\n    },\n    destination: destination\n  };\n}\n\nfunction getExternalContext(data) {\n  var url = data.url,\n      method = data.method,\n      target = data.target,\n      response = data.response;\n  var parsedUrl = new Url(url);\n  var destination = getDestination(parsedUrl);\n  var context = {\n    http: {\n      method: method,\n      url: parsedUrl.href\n    },\n    destination: destination\n  };\n  var statusCode;\n\n  if (target && typeof target.status !== 'undefined') {\n    statusCode = target.status;\n  } else if (response) {\n    statusCode = response.status;\n  }\n\n  context.http.status_code = statusCode;\n  return context;\n}\n\nfunction getNavigationContext(data) {\n  var url = data.url;\n  var parsedUrl = new Url(url);\n  var destination = getDestination(parsedUrl);\n  return {\n    destination: destination\n  };\n}\n\nexport function getPageContext() {\n  return {\n    page: {\n      referer: document.referrer,\n      url: location.href\n    }\n  };\n}\nexport function addSpanContext(span, data) {\n  if (!data) {\n    return;\n  }\n\n  var type = span.type;\n  var context;\n\n  switch (type) {\n    case EXTERNAL:\n      context = getExternalContext(data);\n      break;\n\n    case RESOURCE:\n      context = getResourceContext(data);\n      break;\n\n    case HARD_NAVIGATION:\n      context = getNavigationContext(data);\n      break;\n  }\n\n  span.addContext(context);\n}\nexport function addTransactionContext(transaction, _temp) {\n  var _ref = _temp === void 0 ? {} : _temp,\n      tags = _ref.tags,\n      configContext = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  var pageContext = getPageContext();\n  var responseContext = {};\n\n  if (transaction.type === PAGE_LOAD && isPerfTimelineSupported()) {\n    var entries = PERF.getEntriesByType(NAVIGATION);\n\n    if (entries && entries.length > 0) {\n      responseContext = {\n        response: getResponseContext(entries[0])\n      };\n    }\n  }\n\n  transaction.addContext(pageContext, responseContext, configContext);\n}"]},"metadata":{},"sourceType":"module"}