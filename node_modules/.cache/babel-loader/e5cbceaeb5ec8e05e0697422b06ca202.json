{"ast":null,"code":"var _jsxFileName = \"/home/harish/windo/phoenix/src/containers/shop/CreateShop.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport shopIcon from \"../../assets/v2/onboarding/shop.svg\"; // import waIcon from 'assets/v2/onboarding/wa.svg';\n\nimport chevron from \"../../assets/v2/onboarding/chevron.svg\";\nimport { ReactInput, Select, Button, Clickable } from 'phoenix-components';\nimport { useToggle } from \"../../hooks/common\";\nimport * as Yup from 'yup';\nimport SnackBar from \"../../services/snackbar\";\nimport { FooterButton } from \"../../components/common/FooterButton\";\nimport { getCountries } from \"../../utils/countries\";\nimport { useCountryFromIP } from \"../../hooks/utils\";\nimport { Becca } from \"../../api\";\nimport { useDesktop, useLanguage, useSetLanguage } from \"../../contexts\";\nimport { ALL_LANGUAGES } from \"../../components/global/translateUtils\";\nimport { CountryDrawer } from \"../../components/common/CountryDrawer\";\nimport { useHistory } from 'react-router-dom';\nimport EventManager from \"../../utils/events\";\nimport styles from \"./CreateShop.module.css\";\nimport CreateShopDesktop from \"./CreateShopDesktop.jsx\";\nconst schema = Yup.object().shape({\n  name: Yup.string().required().label('shop name'),\n  slug: Yup.string().required().min(4).label('shop url'),\n  country: Yup.string().required().label('country')\n});\nconst currencies = getCountries().map(x => ({\n  label: x.currency,\n  value: x.currency\n}));\n\nfunction CreateShop() {\n  _s();\n\n  const [name, setName] = useState('');\n  const [slug, setSlug] = useState(''); // const [referralCode, setReferralCode] = useState('');\n\n  const [errors, setErrors] = useState({}); // const [showCode, toggleCode] = useToggle(false);\n\n  const language = useLanguage();\n  const [storeLang, setStoreLang] = useState(language || 'en');\n  const storeSelected = ALL_LANGUAGES.find(x => x.value === storeLang);\n  const [subscribe] = useToggle(true);\n  const [openCountryDrawer, toggleCountryDrawer] = useToggle(false);\n  const [country, setCountry, currency, setCurrency] = useCountryFromIP('', '', true);\n  const history = useHistory();\n  const isDesktop = useDesktop();\n  const setLanguage = useSetLanguage();\n\n  const createShop = async () => {\n    try {\n      setErrors({});\n      const obj = {\n        name,\n        slug,\n        country,\n        currency,\n        tos: {\n          whatsapp: {\n            subscribed: subscribe\n          }\n        }\n      };\n      await schema.validate(obj, {\n        abortEarly: false\n      });\n\n      if (!obj.config) {\n        obj.config = {};\n      }\n\n      obj.config.lang = storeLang;\n      await Becca.createShop(obj);\n      EventManager.emitEvent('shop_created', {\n        name,\n        slug,\n        country\n      });\n      setLanguage(storeLang);\n      history.go();\n    } catch (e) {\n      var _e$response, _e$response$data;\n\n      if (e.name === 'ValidationError') {\n        setErrors(e.inner.reduce((acc, err) => {\n          acc[err.path] = err.message;\n          return acc;\n        }, {}));\n        return;\n      }\n\n      const error = e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : (_e$response$data = _e$response.data) === null || _e$response$data === void 0 ? void 0 : _e$response$data.message;\n\n      if (error) {\n        if (error.toLowerCase() === 'shop url already taken') {\n          setErrors({\n            slug: 'URL already exists'\n          });\n          SnackBar.show('URL already exists', 'error');\n          return;\n        }\n\n        SnackBar.show(error, 'error');\n        return;\n      }\n\n      SnackBar.show('shop creation failed', 'error');\n    }\n  };\n\n  const onShopNameChange = () => name => {\n    const slug = name.replace(/[^A-Za-z0-9_]/g, '').replace(/_+/g, '').toLowerCase();\n    setName(name);\n    setSlug(slug);\n  };\n\n  const onSetSlug = () => slug => {\n    setSlug(slug.toLowerCase());\n  };\n\n  const onCountryChange = ({\n    value,\n    currrency\n  }) => {\n    setCountry(value);\n    setCurrency(currrency);\n    toggleCountryDrawer();\n  };\n\n  const onCurrencyChange = currrency => {\n    setCurrency(currrency.value);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 5\n    }\n  }, isDesktop && /*#__PURE__*/React.createElement(CreateShopDesktop, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 21\n    }\n  }), !isDesktop && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.top,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: shopIcon,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.heading,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 15\n    }\n  }, \"Create Your Shop\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.drawer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.overflow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(ReactInput, {\n    label: \"Enter Shop Name\",\n    placeholder: \"e.g. brilliant boutique\",\n    setValue: onShopNameChange(),\n    value: name,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 17\n    }\n  }), (errors === null || errors === void 0 ? void 0 : errors.name) && /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.error,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 35\n    }\n  }, errors.name), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.shopUrl,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 17\n    }\n  }, \"Shop URL\"), /*#__PURE__*/React.createElement(ReactInput, {\n    placeholder: \"e.g. brilliantboutique\",\n    startLabel: \"mywindo.shop/\",\n    value: slug,\n    setValue: onSetSlug(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 17\n    }\n  }), (errors === null || errors === void 0 ? void 0 : errors.slug) && /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.error,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 35\n    }\n  }, errors.slug), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.helperText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 17\n    }\n  }, \"You can always connect your custom domain later\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.country,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 17\n    }\n  }, openCountryDrawer && /*#__PURE__*/React.createElement(CountryDrawer, {\n    onSelect: onCountryChange,\n    onBack: toggleCountryDrawer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(Clickable, {\n    className: styles.countrySelect,\n    onClick: toggleCountryDrawer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.cLabel,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 23\n    }\n  }, \"Select Country\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.cValue,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.ellipsis,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 25\n    }\n  }, country.toLowerCase() === 'usa' ? 'USA' : country), /*#__PURE__*/React.createElement(\"img\", {\n    src: chevron,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 25\n    }\n  }))), (errors === null || errors === void 0 ? void 0 : errors.country) && /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.error,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 42\n    }\n  }, errors.country)), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    options: currencies,\n    label: \"Currency\",\n    value: currencies.find(c => c.value === currency),\n    onChange: e => onCurrencyChange(e),\n    isDisabled: false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 21\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    translate: \"no\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    options: ALL_LANGUAGES,\n    label: \"Select Language\",\n    onChange: val => setStoreLang(val.value),\n    value: storeSelected,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 19\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.helperTextD,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 19\n    }\n  }, \"You can always change your language later in settings\"))), /*#__PURE__*/React.createElement(FooterButton, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    size: \"large\",\n    label: \"Create Shop\",\n    fullWidth: true,\n    bordered: false,\n    onClick: createShop,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 17\n    }\n  })))));\n}\n\n_s(CreateShop, \"iieduPlw5X0gkgPrP3LQkw4JJXg=\", false, function () {\n  return [useLanguage, useToggle, useToggle, useCountryFromIP, useHistory, useDesktop, useSetLanguage];\n});\n\n_c = CreateShop;\nexport default CreateShop;\n\nvar _c;\n\n$RefreshReg$(_c, \"CreateShop\");","map":{"version":3,"sources":["/home/harish/windo/phoenix/src/containers/shop/CreateShop.jsx"],"names":["React","useState","ReactInput","Select","Button","Clickable","useToggle","Yup","SnackBar","FooterButton","getCountries","useCountryFromIP","Becca","useDesktop","useLanguage","useSetLanguage","ALL_LANGUAGES","CountryDrawer","useHistory","EventManager","styles","CreateShopDesktop","schema","object","shape","name","string","required","label","slug","min","country","currencies","map","x","currency","value","CreateShop","setName","setSlug","errors","setErrors","language","storeLang","setStoreLang","storeSelected","find","subscribe","openCountryDrawer","toggleCountryDrawer","setCountry","setCurrency","history","isDesktop","setLanguage","createShop","obj","tos","whatsapp","subscribed","validate","abortEarly","config","lang","emitEvent","go","e","inner","reduce","acc","err","path","message","error","response","data","toLowerCase","show","onShopNameChange","replace","onSetSlug","onCountryChange","currrency","onCurrencyChange","container","top","shopIcon","heading","drawer","overflow","shopUrl","helperText","countrySelect","cLabel","cValue","ellipsis","chevron","c","val","helperTextD"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,QAAgC,OAAhC;4DAEA;;;AAEA,SACEC,UADF,EACcC,MADd,EACsBC,MADtB,EAC8BC,SAD9B,QAEO,oBAFP;AAGA,SAASC,SAAT;AACA,OAAO,KAAKC,GAAZ,MAAqB,KAArB;AACA,OAAOC,QAAP;AACA,SAASC,YAAT;AACA,SAASC,YAAT;AACA,SAASC,gBAAT;AACA,SAASC,KAAT;AACA,SAASC,UAAT,EAAqBC,WAArB,EAAkCC,cAAlC;AACA,SAASC,aAAT;AACA,SAASC,aAAT;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,OAAOC,YAAP;AACA,OAAOC,MAAP;AACA,OAAOC,iBAAP;AAEA,MAAMC,MAAM,GAAGf,GAAG,CAACgB,MAAJ,GAAaC,KAAb,CAAmB;AAChCC,EAAAA,IAAI,EAAElB,GAAG,CAACmB,MAAJ,GAAaC,QAAb,GAAwBC,KAAxB,CAA8B,WAA9B,CAD0B;AAEhCC,EAAAA,IAAI,EAAEtB,GAAG,CAACmB,MAAJ,GAAaC,QAAb,GAAwBG,GAAxB,CAA4B,CAA5B,EAA+BF,KAA/B,CAAqC,UAArC,CAF0B;AAGhCG,EAAAA,OAAO,EAAExB,GAAG,CAACmB,MAAJ,GAAaC,QAAb,GAAwBC,KAAxB,CAA8B,SAA9B;AAHuB,CAAnB,CAAf;AAMA,MAAMI,UAAU,GAAGtB,YAAY,GAAGuB,GAAf,CAAmBC,CAAC,KAAK;AAAEN,EAAAA,KAAK,EAAEM,CAAC,CAACC,QAAX;AAAqBC,EAAAA,KAAK,EAAEF,CAAC,CAACC;AAA9B,CAAL,CAApB,CAAnB;;AAEA,SAASE,UAAT,GAAsB;AAAA;;AACpB,QAAM,CAACZ,IAAD,EAAOa,OAAP,IAAkBrC,QAAQ,CAAC,EAAD,CAAhC;AACA,QAAM,CAAC4B,IAAD,EAAOU,OAAP,IAAkBtC,QAAQ,CAAC,EAAD,CAAhC,CAFoB,CAGpB;;AACA,QAAM,CAACuC,MAAD,EAASC,SAAT,IAAsBxC,QAAQ,CAAC,EAAD,CAApC,CAJoB,CAKpB;;AACA,QAAMyC,QAAQ,GAAG5B,WAAW,EAA5B;AACA,QAAM,CAAC6B,SAAD,EAAYC,YAAZ,IAA4B3C,QAAQ,CAACyC,QAAQ,IAAI,IAAb,CAA1C;AACA,QAAMG,aAAa,GAAG7B,aAAa,CAAC8B,IAAd,CAAmBZ,CAAC,IAAIA,CAAC,CAACE,KAAF,KAAYO,SAApC,CAAtB;AACA,QAAM,CAACI,SAAD,IAAczC,SAAS,CAAC,IAAD,CAA7B;AACA,QAAM,CAAC0C,iBAAD,EAAoBC,mBAApB,IAA2C3C,SAAS,CAAC,KAAD,CAA1D;AACA,QAAM,CAACyB,OAAD,EAAUmB,UAAV,EAAsBf,QAAtB,EAAgCgB,WAAhC,IAA+CxC,gBAAgB,CAAC,EAAD,EAAK,EAAL,EAAS,IAAT,CAArE;AACA,QAAMyC,OAAO,GAAGlC,UAAU,EAA1B;AACA,QAAMmC,SAAS,GAAGxC,UAAU,EAA5B;AACA,QAAMyC,WAAW,GAAGvC,cAAc,EAAlC;;AAEA,QAAMwC,UAAU,GAAG,YAAY;AAC7B,QAAI;AACFd,MAAAA,SAAS,CAAC,EAAD,CAAT;AACA,YAAMe,GAAG,GAAG;AACV/B,QAAAA,IADU;AACJI,QAAAA,IADI;AACEE,QAAAA,OADF;AACWI,QAAAA,QADX;AACqBsB,QAAAA,GAAG,EAAE;AAAEC,UAAAA,QAAQ,EAAE;AAAEC,YAAAA,UAAU,EAAEZ;AAAd;AAAZ;AAD1B,OAAZ;AAGA,YAAMzB,MAAM,CAACsC,QAAP,CAAgBJ,GAAhB,EAAqB;AACzBK,QAAAA,UAAU,EAAE;AADa,OAArB,CAAN;;AAGA,UAAI,CAACL,GAAG,CAACM,MAAT,EAAiB;AACfN,QAAAA,GAAG,CAACM,MAAJ,GAAa,EAAb;AACD;;AACDN,MAAAA,GAAG,CAACM,MAAJ,CAAWC,IAAX,GAAkBpB,SAAlB;AACA,YAAM/B,KAAK,CAAC2C,UAAN,CAAiBC,GAAjB,CAAN;AACArC,MAAAA,YAAY,CAAC6C,SAAb,CAAuB,cAAvB,EAAuC;AACrCvC,QAAAA,IADqC;AAC/BI,QAAAA,IAD+B;AACzBE,QAAAA;AADyB,OAAvC;AAGAuB,MAAAA,WAAW,CAACX,SAAD,CAAX;AACAS,MAAAA,OAAO,CAACa,EAAR;AACD,KAlBD,CAkBE,OAAOC,CAAP,EAAU;AAAA;;AACV,UAAIA,CAAC,CAACzC,IAAF,KAAW,iBAAf,EAAkC;AAChCgB,QAAAA,SAAS,CAACyB,CAAC,CAACC,KAAF,CAAQC,MAAR,CAAe,CAACC,GAAD,EAAMC,GAAN,KAAc;AACrCD,UAAAA,GAAG,CAACC,GAAG,CAACC,IAAL,CAAH,GAAgBD,GAAG,CAACE,OAApB;AACA,iBAAOH,GAAP;AACD,SAHS,EAGP,EAHO,CAAD,CAAT;AAIA;AACD;;AACD,YAAMI,KAAK,GAAGP,CAAH,aAAGA,CAAH,sCAAGA,CAAC,CAAEQ,QAAN,oEAAG,YAAaC,IAAhB,qDAAG,iBAAmBH,OAAjC;;AACA,UAAIC,KAAJ,EAAW;AACT,YAAIA,KAAK,CAACG,WAAN,OAAwB,wBAA5B,EAAsD;AACpDnC,UAAAA,SAAS,CAAC;AAAEZ,YAAAA,IAAI,EAAE;AAAR,WAAD,CAAT;AACArB,UAAAA,QAAQ,CAACqE,IAAT,CAAc,oBAAd,EAAoC,OAApC;AACA;AACD;;AACDrE,QAAAA,QAAQ,CAACqE,IAAT,CAAcJ,KAAd,EAAqB,OAArB;AACA;AACD;;AACDjE,MAAAA,QAAQ,CAACqE,IAAT,CAAc,sBAAd,EAAsC,OAAtC;AACD;AACF,GAvCD;;AAyCA,QAAMC,gBAAgB,GAAG,MAAOrD,IAAD,IAAU;AACvC,UAAMI,IAAI,GAAGJ,IAAI,CAACsD,OAAL,CAAa,gBAAb,EAA+B,EAA/B,EACVA,OADU,CACF,KADE,EACK,EADL,EACSH,WADT,EAAb;AAEAtC,IAAAA,OAAO,CAACb,IAAD,CAAP;AACAc,IAAAA,OAAO,CAACV,IAAD,CAAP;AACD,GALD;;AAOA,QAAMmD,SAAS,GAAG,MAAOnD,IAAD,IAAU;AAChCU,IAAAA,OAAO,CAACV,IAAI,CAAC+C,WAAL,EAAD,CAAP;AACD,GAFD;;AAIA,QAAMK,eAAe,GAAG,CAAC;AAAE7C,IAAAA,KAAF;AAAS8C,IAAAA;AAAT,GAAD,KAA0B;AAChDhC,IAAAA,UAAU,CAACd,KAAD,CAAV;AACAe,IAAAA,WAAW,CAAC+B,SAAD,CAAX;AACAjC,IAAAA,mBAAmB;AACpB,GAJD;;AAMA,QAAMkC,gBAAgB,GAAID,SAAD,IAAe;AACtC/B,IAAAA,WAAW,CAAC+B,SAAS,CAAC9C,KAAX,CAAX;AACD,GAFD;;AAIA,sBACE;AAAK,IAAA,SAAS,EAAEhB,MAAM,CAACgE,SAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACG/B,SAAS,iBAAI,oBAAC,iBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADhB,EAEG,CAACA,SAAD,iBAEG,uDACE;AAAK,IAAA,SAAS,EAAEjC,MAAM,CAACiE,GAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAK,IAAA,GAAG,EAAEC,QAAV;AAAoB,IAAA,GAAG,EAAC,EAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,eAEE;AAAK,IAAA,SAAS,EAAElE,MAAM,CAACmE,OAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAFF,CADF,eAOE;AAAK,IAAA,SAAS,EAAEnE,MAAM,CAACoE,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAK,IAAA,SAAS,EAAEpE,MAAM,CAACqE,QAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,UAAD;AACE,IAAA,KAAK,EAAC,iBADR;AAEE,IAAA,WAAW,EAAC,yBAFd;AAGE,IAAA,QAAQ,EAAEX,gBAAgB,EAH5B;AAIE,IAAA,KAAK,EAAErD,IAJT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,EAOG,CAAAe,MAAM,SAAN,IAAAA,MAAM,WAAN,YAAAA,MAAM,CAAEf,IAAR,kBAAiB;AAAK,IAAA,SAAS,EAAEL,MAAM,CAACqD,KAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA+BjC,MAAM,CAACf,IAAtC,CAPpB,eAQE;AAAK,IAAA,SAAS,EAAEL,MAAM,CAACsE,OAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBARF,eASE,oBAAC,UAAD;AACE,IAAA,WAAW,EAAC,wBADd;AAEE,IAAA,UAAU,EAAC,eAFb;AAGE,IAAA,KAAK,EAAE7D,IAHT;AAIE,IAAA,QAAQ,EAAEmD,SAAS,EAJrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IATF,EAeG,CAAAxC,MAAM,SAAN,IAAAA,MAAM,WAAN,YAAAA,MAAM,CAAEX,IAAR,kBAAiB;AAAK,IAAA,SAAS,EAAET,MAAM,CAACqD,KAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA+BjC,MAAM,CAACX,IAAtC,CAfpB,eAgBE;AAAK,IAAA,SAAS,EAAET,MAAM,CAACuE,UAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uDAhBF,eAmBE;AAAK,IAAA,SAAS,EAAEvE,MAAM,CAACW,OAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGiB,iBAAiB,iBAChB,oBAAC,aAAD;AAAe,IAAA,QAAQ,EAAEiC,eAAzB;AAA0C,IAAA,MAAM,EAAEhC,mBAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFJ,eAIE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,SAAD;AACE,IAAA,SAAS,EAAE7B,MAAM,CAACwE,aADpB;AAEE,IAAA,OAAO,EAAE3C,mBAFX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAIE;AAAK,IAAA,SAAS,EAAE7B,MAAM,CAACyE,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAJF,eAOE;AAAK,IAAA,SAAS,EAAEzE,MAAM,CAAC0E,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE;AAAK,IAAA,SAAS,EAAE1E,MAAM,CAAC2E,QAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACGhE,OAAO,CAAC6C,WAAR,OAA0B,KAA1B,GAAkC,KAAlC,GAA0C7C,OAD7C,CADF,eAIE;AAAK,IAAA,GAAG,EAAEiE,OAAV;AAAmB,IAAA,GAAG,EAAC,EAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAJF,CAPF,CADF,EAeG,CAAAxD,MAAM,SAAN,IAAAA,MAAM,WAAN,YAAAA,MAAM,CAAET,OAAR,kBAAoB;AAAK,IAAA,SAAS,EAAEX,MAAM,CAACqD,KAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA+BjC,MAAM,CAACT,OAAtC,CAfvB,CAJF,eAqBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,MAAD;AACE,IAAA,OAAO,EAAEC,UADX;AAEE,IAAA,KAAK,EAAC,UAFR;AAGE,IAAA,KAAK,EAAEA,UAAU,CAACc,IAAX,CAAgBmD,CAAC,IAAIA,CAAC,CAAC7D,KAAF,KAAYD,QAAjC,CAHT;AAIE,IAAA,QAAQ,EAAG+B,CAAD,IAAOiB,gBAAgB,CAACjB,CAAD,CAJnC;AAKE,IAAA,UAAU,EAAE,KALd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CArBF,CAnBF,eAkDE;AAAK,IAAA,SAAS,EAAC,IAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,MAAD;AACE,IAAA,OAAO,EAAElD,aADX;AAEE,IAAA,KAAK,EAAC,iBAFR;AAGE,IAAA,QAAQ,EAAGkF,GAAD,IAAStD,YAAY,CAACsD,GAAG,CAAC9D,KAAL,CAHjC;AAIE,IAAA,KAAK,EAAES,aAJT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,eAOE;AAAK,IAAA,SAAS,EAAEzB,MAAM,CAAC+E,WAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6DAPF,CAlDF,CADF,eA2EE,oBAAC,YAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,MAAD;AACE,IAAA,IAAI,EAAC,OADP;AAEE,IAAA,KAAK,EAAC,aAFR;AAGE,IAAA,SAAS,MAHX;AAIE,IAAA,QAAQ,EAAE,KAJZ;AAKE,IAAA,OAAO,EAAE5C,UALX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,CA3EF,CAPF,CAJN,CADF;AAqGD;;GAnLQlB,U;UAMUvB,W,EAGGR,S,EAC6BA,S,EACIK,gB,EACrCO,U,EACEL,U,EACEE,c;;;KAdbsB,U;AAqLT,eAAeA,UAAf","sourcesContent":["import React, { useState } from 'react';\nimport shopIcon from 'assets/v2/onboarding/shop.svg';\n// import waIcon from 'assets/v2/onboarding/wa.svg';\nimport chevron from 'assets/v2/onboarding/chevron.svg';\nimport {\n  ReactInput, Select, Button, Clickable\n} from 'phoenix-components';\nimport { useToggle } from 'hooks/common';\nimport * as Yup from 'yup';\nimport SnackBar from 'services/snackbar';\nimport { FooterButton } from 'components/common/FooterButton';\nimport { getCountries } from 'utils/countries';\nimport { useCountryFromIP } from 'hooks/utils';\nimport { Becca } from 'api';\nimport { useDesktop, useLanguage, useSetLanguage } from 'contexts';\nimport { ALL_LANGUAGES } from 'components/global/translateUtils';\nimport { CountryDrawer } from 'components/common/CountryDrawer';\nimport { useHistory } from 'react-router-dom';\nimport EventManager from 'utils/events';\nimport styles from './CreateShop.module.css';\nimport CreateShopDesktop from './CreateShopDesktop.jsx';\n\nconst schema = Yup.object().shape({\n  name: Yup.string().required().label('shop name'),\n  slug: Yup.string().required().min(4).label('shop url'),\n  country: Yup.string().required().label('country'),\n});\n\nconst currencies = getCountries().map(x => ({ label: x.currency, value: x.currency }));\n\nfunction CreateShop() {\n  const [name, setName] = useState('');\n  const [slug, setSlug] = useState('');\n  // const [referralCode, setReferralCode] = useState('');\n  const [errors, setErrors] = useState({});\n  // const [showCode, toggleCode] = useToggle(false);\n  const language = useLanguage();\n  const [storeLang, setStoreLang] = useState(language || 'en');\n  const storeSelected = ALL_LANGUAGES.find(x => x.value === storeLang);\n  const [subscribe] = useToggle(true);\n  const [openCountryDrawer, toggleCountryDrawer] = useToggle(false);\n  const [country, setCountry, currency, setCurrency] = useCountryFromIP('', '', true);\n  const history = useHistory();\n  const isDesktop = useDesktop();\n  const setLanguage = useSetLanguage();\n\n  const createShop = async () => {\n    try {\n      setErrors({});\n      const obj = {\n        name, slug, country, currency, tos: { whatsapp: { subscribed: subscribe } }\n      };\n      await schema.validate(obj, {\n        abortEarly: false\n      });\n      if (!obj.config) {\n        obj.config = {};\n      }\n      obj.config.lang = storeLang;\n      await Becca.createShop(obj);\n      EventManager.emitEvent('shop_created', {\n        name, slug, country,\n      });\n      setLanguage(storeLang);\n      history.go();\n    } catch (e) {\n      if (e.name === 'ValidationError') {\n        setErrors(e.inner.reduce((acc, err) => {\n          acc[err.path] = err.message;\n          return acc;\n        }, {}));\n        return;\n      }\n      const error = e?.response?.data?.message;\n      if (error) {\n        if (error.toLowerCase() === 'shop url already taken') {\n          setErrors({ slug: 'URL already exists' });\n          SnackBar.show('URL already exists', 'error');\n          return;\n        }\n        SnackBar.show(error, 'error');\n        return;\n      }\n      SnackBar.show('shop creation failed', 'error');\n    }\n  };\n\n  const onShopNameChange = () => (name) => {\n    const slug = name.replace(/[^A-Za-z0-9_]/g, '')\n      .replace(/_+/g, '').toLowerCase();\n    setName(name);\n    setSlug(slug);\n  };\n\n  const onSetSlug = () => (slug) => {\n    setSlug(slug.toLowerCase());\n  };\n\n  const onCountryChange = ({ value, currrency }) => {\n    setCountry(value);\n    setCurrency(currrency);\n    toggleCountryDrawer();\n  };\n\n  const onCurrencyChange = (currrency) => {\n    setCurrency(currrency.value);\n  };\n\n  return (\n    <div className={styles.container}>\n      {isDesktop && <CreateShopDesktop />}\n      {!isDesktop\n        && (\n          <>\n            <div className={styles.top}>\n              <img src={shopIcon} alt=\"\" />\n              <div className={styles.heading}>\n                Create Your Shop\n              </div>\n            </div>\n            <div className={styles.drawer}>\n              <div className={styles.overflow}>\n                <ReactInput\n                  label=\"Enter Shop Name\"\n                  placeholder=\"e.g. brilliant boutique\"\n                  setValue={onShopNameChange()}\n                  value={name}\n                />\n                {errors?.name && (<div className={styles.error}>{errors.name}</div>)}\n                <div className={styles.shopUrl}>Shop URL</div>\n                <ReactInput\n                  placeholder=\"e.g. brilliantboutique\"\n                  startLabel=\"mywindo.shop/\"\n                  value={slug}\n                  setValue={onSetSlug()}\n                />\n                {errors?.slug && (<div className={styles.error}>{errors.slug}</div>)}\n                <div className={styles.helperText}>\n                  You can always connect your custom domain later\n                </div>\n                <div className={styles.country}>\n                  {openCountryDrawer && (\n                    <CountryDrawer onSelect={onCountryChange} onBack={toggleCountryDrawer} />\n                  )}\n                  <div>\n                    <Clickable\n                      className={styles.countrySelect}\n                      onClick={toggleCountryDrawer}\n                    >\n                      <div className={styles.cLabel}>\n                        Select Country\n                      </div>\n                      <div className={styles.cValue}>\n                        <div className={styles.ellipsis}>\n                          {country.toLowerCase() === 'usa' ? 'USA' : country }\n                        </div>\n                        <img src={chevron} alt=\"\" />\n                      </div>\n                    </Clickable>\n                    {errors?.country && (<div className={styles.error}>{errors.country}</div>)}\n                  </div>\n                  <div>\n                    <Select\n                      options={currencies}\n                      label=\"Currency\"\n                      value={currencies.find(c => c.value === currency)}\n                      onChange={(e) => onCurrencyChange(e)}\n                      isDisabled={false}\n                    />\n                  </div>\n                </div>\n                <div translate=\"no\">\n                  <Select\n                    options={ALL_LANGUAGES}\n                    label=\"Select Language\"\n                    onChange={(val) => setStoreLang(val.value)}\n                    value={storeSelected}\n                  />\n                  <div className={styles.helperTextD}>\n                    You can always change your language later in settings\n                  </div>\n                </div>\n                {/* <Clickable className={styles.code} onClick={toggleCode}>\n                  Have Referral code?\n                </Clickable>\n                {showCode && (\n                  <ReactInput\n                    label=\"Referral Code\"\n                    placeholder=\"e.g. 23ABCD\"\n                    value={referralCode}\n                    setValue={setReferralCode}\n                  />\n                )}\n                {errors?.referralCode && (<div className={styles.error}>{errors.referralCode}</div>)} */}\n              </div>\n              <FooterButton>\n                <Button\n                  size=\"large\"\n                  label=\"Create Shop\"\n                  fullWidth\n                  bordered={false}\n                  onClick={createShop}\n                />\n              </FooterButton>\n            </div>\n          </>\n        )}\n    </div>\n  );\n}\n\nexport default CreateShop;\n"]},"metadata":{},"sourceType":"module"}