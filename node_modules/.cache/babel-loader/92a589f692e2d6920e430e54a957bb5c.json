{"ast":null,"code":"var _jsxFileName = \"/home/harish/windo/phoenix/src/components/orders/CenterButton.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport { useEnableAccept, useEnableCancel, useEnablePendingCustomization, useGetIds, useOrder, useRefresh } from \"../../contexts/orderContext\";\nimport { Factory } from \"../../api\";\nimport SnackBar from \"../../services/snackbar\";\nimport deliveryTag from \"../../assets/images/orders/details/tag.svg\";\nimport { Drawer } from '@material-ui/core';\nimport emailIcon from \"../../assets/images/email.svg\";\nimport downloadIcon from \"../../assets/images/orders/details/download.svg\";\nimport CONFIG from \"../../config\";\nimport Storage from \"../../services/storage\";\nimport WebView from \"../../services/webview\";\nimport fileDownload from 'js-file-download';\nimport { useIsWebView } from \"../../hooks\";\nimport Loader from \"../../services/loader\";\nimport cx from 'classnames';\nimport { get } from 'lodash';\nimport { useHistory } from 'react-router-dom';\nimport { Button, Clickable } from 'phoenix-components';\nimport { useToggle } from \"../../hooks/common\";\nimport { DeleteAlert } from \"../shared/DeleteAlert\";\nimport PropTypes from 'prop-types';\nimport { useDesktop } from \"../../contexts\";\nimport Alert from \"../shared/alert/Alert\";\nimport EventManager from \"../../utils/events\";\nimport styles from \"./CenterButton.module.css\";\nexport function CenterButton({\n  order,\n  hideLabel\n}) {\n  _s();\n\n  const enableCancel = useEnableCancel();\n  const enableConfirm = useEnableAccept();\n  const enableCustomizationPending = useEnablePendingCustomization();\n  const enableDelivered = get(order, 'buttons.enableDelivered', false);\n  const enableOutForDelivery = get(order, 'buttons.enableOutForDelivery', false);\n  const enableDownloadLabel = get(order, 'buttons.enableDownloadLabel', false);\n  const webview = useIsWebView();\n  const refresh = useRefresh();\n  const rootOrder = useOrder();\n  const [downloadEl, setDownloadEl] = useState(null);\n  const [openCancel, toggleCancel] = useToggle();\n  const [showError, setShowError] = useToggle(false);\n  const ids = useGetIds();\n  const emptyIdErr = 'Oops! You haven\\'t ticked the orders you\\'d like to proceed with.';\n  const history = useHistory();\n  const isDesktop = useDesktop();\n\n  const acceptOrder = async () => {\n    try {\n      Loader.show();\n\n      if (ids.length === 0) {\n        setShowError();\n        return;\n      }\n\n      await Factory.confirm(rootOrder._id, {\n        ids\n      });\n      EventManager.emitEvent('order_accepted', {\n        id: rootOrder._id,\n        length: ids.length\n      });\n      await refresh();\n    } catch (e) {\n      var _e$response;\n\n      console.error(e);\n\n      if ((e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : _e$response.status) === 412) {\n        SnackBar.show('Please add bank details to accept order', 'error');\n        history.push('/manage/bank');\n        return;\n      }\n\n      SnackBar.showError(e);\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const deliverOrder = async () => {\n    try {\n      Loader.show();\n      await Factory.deliver(rootOrder._id, order.groupId);\n      EventManager.emitEvent('order_delivered', {\n        id: rootOrder._id,\n        groupId: order.groupId,\n        type: 'self'\n      });\n      await refresh();\n    } catch (e) {\n      console.error(e);\n      SnackBar.show('Something went wrong', 'error');\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const openDownload = e => {\n    setDownloadEl(e.currentTarget);\n  };\n\n  const closeDownload = () => {\n    setDownloadEl(false);\n  };\n\n  const cancelOrder = async () => {\n    try {\n      Loader.show();\n      await Factory.cancelOrder(rootOrder._id);\n      await refresh();\n    } catch (e) {\n      console.error(e);\n      SnackBar.show('Something went wrong', 'error');\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const sendEmail = async () => {\n    try {\n      Loader.show();\n      await Factory.sendEmailLabel(rootOrder._id, order.groupId);\n      SnackBar.show('Sent to your email');\n    } catch (e) {\n      SnackBar.show('Something went wrong', 'error');\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const downloadLabel = async () => {\n    const path = `${rootOrder._id}/${order.groupId}`;\n\n    try {\n      Loader.show();\n\n      if (webview) {\n        const url = `${CONFIG.FACTORY.host}/seller/orders/${path}/label?authorization=${Storage.getItem('token')}`;\n        await WebView.download(url);\n        return;\n      }\n\n      const {\n        data,\n        headers\n      } = await Factory.getLabel(rootOrder._id, order.groupId);\n      fileDownload(data, headers['x-suggested-filename'], headers['content-type']);\n    } catch (e) {\n      SnackBar.show('Something went wrong', 'error');\n    } finally {\n      closeDownload();\n      Loader.hide();\n    }\n  };\n\n  if (enableCustomizationPending) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.customizationPending,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 7\n      }\n    }, \"Customization charges not paid\");\n  }\n\n  if (enableConfirm && !order.groupId) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.btn,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 7\n      }\n    }, showError && /*#__PURE__*/React.createElement(Alert, {\n      text: emptyIdErr,\n      btnText: \"Ok\",\n      textClass: styles.textClass,\n      onClick: setShowError,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 11\n      }\n    }), openCancel && /*#__PURE__*/React.createElement(DeleteAlert, {\n      title: \"Oops! Are you sure want to cancel this order?\",\n      subTitle: \"Sure you want to cancel this order?\",\n      onCancel: toggleCancel,\n      onDelete: cancelOrder,\n      primary: \"Yes\",\n      secondary: \"No\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 11\n      }\n    }), enableCancel && /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Clickable, {\n      className: styles.cancelButton,\n      onClick: toggleCancel,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 13\n      }\n    }, \"Cancel Order?\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"flexCenter\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      fullWidth: !isDesktop,\n      label: `Accept Order${ids.length > 1 ? 's' : ''}`,\n      onClick: acceptOrder,\n      size: \"large\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 11\n      }\n    })));\n  }\n\n  if (enableDelivered && !enableOutForDelivery) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: cx(styles.btn, 'flexCenter'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      label: \"Delivered\",\n      onClick: deliverOrder,\n      size: \"large\",\n      fullWidth: !isDesktop,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 9\n      }\n    }));\n  }\n\n  if (enableDownloadLabel && !hideLabel) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Drawer, {\n      anchor: \"bottom\",\n      open: !!downloadEl,\n      onClose: closeDownload,\n      PaperProps: {\n        classes: {\n          root: styles.paper\n        }\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.downloadPopoverRoot,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      onClick: sendEmail,\n      className: cx(styles.downloadPopoverContainer, styles.border),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: emailIcon,\n      alt: \"\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.downloadPopoverLabel,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 15\n      }\n    }, \"Send to email\")), /*#__PURE__*/React.createElement(\"div\", {\n      onClick: downloadLabel,\n      className: styles.downloadPopoverContainer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: downloadIcon,\n      alt: \"\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: cx(styles.downloadPopoverLabel, styles.lSpacing),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 15\n      }\n    }, \"Download\")))), /*#__PURE__*/React.createElement(\"div\", {\n      onClick: openDownload,\n      className: styles.iconContainer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: deliveryTag,\n      alt: \"\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.iconLabel,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 11\n      }\n    }, \"Shipping Label\")));\n  }\n\n  if (enableCancel) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: cx(styles.btn, 'flexCenter'),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      label: \"Cancel Order\",\n      fullWidth: !isDesktop,\n      onClick: toggleCancel,\n      size: \"large\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 9\n      }\n    }), openCancel && /*#__PURE__*/React.createElement(DeleteAlert, {\n      title: \"Oops! Are you sure want to cancel this order?\",\n      subTitle: \"Sure you want to cancel this order?\",\n      onCancel: toggleCancel,\n      onDelete: cancelOrder,\n      primary: \"Yes\",\n      secondary: \"No\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 11\n      }\n    }));\n  }\n\n  return null;\n}\n\n_s(CenterButton, \"oelOHbpwngkRwmbl/vuXQ9/Hpno=\", false, function () {\n  return [useEnableCancel, useEnableAccept, useEnablePendingCustomization, useIsWebView, useRefresh, useOrder, useToggle, useToggle, useGetIds, useHistory, useDesktop];\n});\n\n_c = CenterButton;\nCenterButton.propTypes = {\n  order: PropTypes.any,\n  groupId: PropTypes.string,\n  hideLabel: PropTypes.bool\n};\nCenterButton.defaultProps = {\n  groupId: '',\n  order: {},\n  hideLabel: false\n};\n\nvar _c;\n\n$RefreshReg$(_c, \"CenterButton\");","map":{"version":3,"sources":["/home/harish/windo/phoenix/src/components/orders/CenterButton.jsx"],"names":["React","useState","useEnableAccept","useEnableCancel","useEnablePendingCustomization","useGetIds","useOrder","useRefresh","Factory","SnackBar","Drawer","CONFIG","Storage","WebView","fileDownload","useIsWebView","Loader","cx","get","useHistory","Button","Clickable","useToggle","DeleteAlert","PropTypes","useDesktop","Alert","EventManager","styles","CenterButton","order","hideLabel","enableCancel","enableConfirm","enableCustomizationPending","enableDelivered","enableOutForDelivery","enableDownloadLabel","webview","refresh","rootOrder","downloadEl","setDownloadEl","openCancel","toggleCancel","showError","setShowError","ids","emptyIdErr","history","isDesktop","acceptOrder","show","length","confirm","_id","emitEvent","id","e","console","error","response","status","push","hide","deliverOrder","deliver","groupId","type","openDownload","currentTarget","closeDownload","cancelOrder","sendEmail","sendEmailLabel","downloadLabel","path","url","FACTORY","host","getItem","download","data","headers","getLabel","customizationPending","btn","textClass","cancelButton","classes","root","paper","downloadPopoverRoot","downloadPopoverContainer","border","emailIcon","downloadPopoverLabel","downloadIcon","lSpacing","iconContainer","deliveryTag","iconLabel","propTypes","any","string","bool","defaultProps"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport {\n  useEnableAccept, useEnableCancel, useEnablePendingCustomization, useGetIds, useOrder, useRefresh\n} from 'contexts/orderContext';\nimport { Factory } from 'api';\nimport SnackBar from 'services/snackbar';\nimport deliveryTag from 'assets/images/orders/details/tag.svg';\nimport { Drawer } from '@material-ui/core';\nimport emailIcon from 'assets/images/email.svg';\nimport downloadIcon from 'assets/images/orders/details/download.svg';\nimport CONFIG from 'config';\nimport Storage from 'services/storage';\nimport WebView from 'services/webview';\nimport fileDownload from 'js-file-download';\nimport { useIsWebView } from 'hooks';\nimport Loader from 'services/loader';\nimport cx from 'classnames';\nimport { get } from 'lodash';\nimport { useHistory } from 'react-router-dom';\nimport { Button, Clickable } from 'phoenix-components';\nimport { useToggle } from 'hooks/common';\nimport { DeleteAlert } from 'components/shared/DeleteAlert';\nimport PropTypes from 'prop-types';\nimport { useDesktop } from 'contexts';\nimport Alert from 'components/shared/alert/Alert';\nimport EventManager from 'utils/events';\nimport styles from './CenterButton.module.css';\n\nexport function CenterButton({\n  order,\n  hideLabel\n}) {\n  const enableCancel = useEnableCancel();\n  const enableConfirm = useEnableAccept();\n  const enableCustomizationPending = useEnablePendingCustomization();\n  const enableDelivered = get(order, 'buttons.enableDelivered', false);\n  const enableOutForDelivery = get(order, 'buttons.enableOutForDelivery', false);\n  const enableDownloadLabel = get(order, 'buttons.enableDownloadLabel', false);\n  const webview = useIsWebView();\n  const refresh = useRefresh();\n  const rootOrder = useOrder();\n  const [downloadEl, setDownloadEl] = useState(null);\n  const [openCancel, toggleCancel] = useToggle();\n  const [showError, setShowError] = useToggle(false);\n  const ids = useGetIds();\n  const emptyIdErr = 'Oops! You haven\\'t ticked the orders you\\'d like to proceed with.';\n\n  const history = useHistory();\n  const isDesktop = useDesktop();\n\n  const acceptOrder = async () => {\n    try {\n      Loader.show();\n      if (ids.length === 0) {\n        setShowError();\n        return;\n      }\n      await Factory.confirm(rootOrder._id, { ids });\n      EventManager.emitEvent('order_accepted', {\n        id: rootOrder._id,\n        length: ids.length,\n      });\n      await refresh();\n    } catch (e) {\n      console.error(e);\n      if (e?.response?.status === 412) {\n        SnackBar.show('Please add bank details to accept order', 'error');\n        history.push('/manage/bank');\n        return;\n      }\n      SnackBar.showError(e);\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const deliverOrder = async () => {\n    try {\n      Loader.show();\n      await Factory.deliver(rootOrder._id, order.groupId);\n      EventManager.emitEvent('order_delivered', {\n        id: rootOrder._id,\n        groupId: order.groupId,\n        type: 'self'\n      });\n      await refresh();\n    } catch (e) {\n      console.error(e);\n      SnackBar.show('Something went wrong', 'error');\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const openDownload = (e) => {\n    setDownloadEl(e.currentTarget);\n  };\n\n  const closeDownload = () => {\n    setDownloadEl(false);\n  };\n\n  const cancelOrder = async () => {\n    try {\n      Loader.show();\n      await Factory.cancelOrder(rootOrder._id);\n      await refresh();\n    } catch (e) {\n      console.error(e);\n      SnackBar.show('Something went wrong', 'error');\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const sendEmail = async () => {\n    try {\n      Loader.show();\n      await Factory.sendEmailLabel(rootOrder._id, order.groupId);\n      SnackBar.show('Sent to your email');\n    } catch (e) {\n      SnackBar.show('Something went wrong', 'error');\n    } finally {\n      Loader.hide();\n    }\n  };\n\n  const downloadLabel = async () => {\n    const path = `${rootOrder._id}/${order.groupId}`;\n    try {\n      Loader.show();\n      if (webview) {\n        const url = `${CONFIG.FACTORY.host}/seller/orders/${path}/label?authorization=${Storage.getItem('token')}`;\n        await WebView.download(url);\n        return;\n      }\n      const {\n        data,\n        headers\n      } = await Factory.getLabel(rootOrder._id, order.groupId);\n      fileDownload(data, headers['x-suggested-filename'], headers['content-type']);\n    } catch (e) {\n      SnackBar.show('Something went wrong', 'error');\n    } finally {\n      closeDownload();\n      Loader.hide();\n    }\n  };\n\n  if (enableCustomizationPending) {\n    return (\n      <div className={styles.customizationPending}>\n        Customization charges not paid\n      </div>\n    );\n  }\n\n  if (enableConfirm && !order.groupId) {\n    return (\n      <div className={styles.btn}>\n        {showError && (\n          <Alert\n            text={emptyIdErr}\n            btnText=\"Ok\"\n            textClass={styles.textClass}\n            onClick={setShowError}\n          />\n        )}\n        {openCancel && (\n          <DeleteAlert\n            title=\"Oops! Are you sure want to cancel this order?\"\n            subTitle=\"Sure you want to cancel this order?\"\n            onCancel={toggleCancel}\n            onDelete={cancelOrder}\n            primary=\"Yes\"\n            secondary=\"No\"\n          />\n        )}\n        {enableCancel && (\n          <div>\n            <Clickable className={styles.cancelButton} onClick={toggleCancel}>\n              Cancel Order?\n            </Clickable>\n          </div>\n        )}\n        <div className=\"flexCenter\">\n          <Button\n            fullWidth={!isDesktop}\n            label={`Accept Order${ids.length > 1 ? 's' : ''}`}\n            onClick={acceptOrder}\n            size=\"large\"\n          />\n        </div>\n      </div>\n    );\n  }\n\n  if (enableDelivered && !enableOutForDelivery) {\n    return (\n      <div className={cx(styles.btn, 'flexCenter')}>\n        <Button\n          label=\"Delivered\"\n          onClick={deliverOrder}\n          size=\"large\"\n          fullWidth={!isDesktop}\n        />\n      </div>\n    );\n  }\n\n  if (enableDownloadLabel && !hideLabel) {\n    return (\n      <>\n        <Drawer\n          anchor=\"bottom\"\n          open={!!downloadEl}\n          onClose={closeDownload}\n          PaperProps={{\n            classes: {\n              root: styles.paper,\n            }\n          }}\n        >\n          <div className={styles.downloadPopoverRoot}>\n            <div onClick={sendEmail} className={cx(styles.downloadPopoverContainer, styles.border)}>\n              <img src={emailIcon} alt=\"\" />\n              <div className={styles.downloadPopoverLabel}>Send to email</div>\n            </div>\n            <div onClick={downloadLabel} className={styles.downloadPopoverContainer}>\n              <img src={downloadIcon} alt=\"\" />\n              <div className={cx(styles.downloadPopoverLabel, styles.lSpacing)}>Download</div>\n            </div>\n          </div>\n        </Drawer>\n        <div onClick={openDownload} className={styles.iconContainer}>\n          <img src={deliveryTag} alt=\"\" />\n          <div className={styles.iconLabel}>Shipping Label</div>\n        </div>\n      </>\n    );\n  }\n\n  if (enableCancel) {\n    return (\n      <div className={cx(styles.btn, 'flexCenter')}>\n        <Button\n          label=\"Cancel Order\"\n          fullWidth={!isDesktop}\n          onClick={toggleCancel}\n          size=\"large\"\n        />\n        {openCancel && (\n          <DeleteAlert\n            title=\"Oops! Are you sure want to cancel this order?\"\n            subTitle=\"Sure you want to cancel this order?\"\n            onCancel={toggleCancel}\n            onDelete={cancelOrder}\n            primary=\"Yes\"\n            secondary=\"No\"\n          />\n        )}\n      </div>\n    );\n  }\n\n  return null;\n}\n\nCenterButton.propTypes = {\n  order: PropTypes.any,\n  groupId: PropTypes.string,\n  hideLabel: PropTypes.bool\n};\n\nCenterButton.defaultProps = {\n  groupId: '',\n  order: {},\n  hideLabel: false\n};\n"]},"metadata":{},"sourceType":"module"}