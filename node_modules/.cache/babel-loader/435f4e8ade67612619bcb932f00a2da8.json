{"ast":null,"code":"var _jsxFileName = \"/home/harish/windo/phoenix/src/containers/shop/CreateShopDesktop.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport createYourShopIcon from \"../../assets/v2/onboarding/createYourShopDesk.svg\";\nimport chevron from \"../../assets/v2/onboarding/chevronDown.svg\";\nimport { ReactInput, Select, Button, Clickable } from 'phoenix-components';\nimport * as Yup from 'yup';\nimport { Grid } from '@material-ui/core';\nimport SnackBar from \"../../services/snackbar\";\nimport { useToggle } from \"../../hooks/common\";\nimport { getCountries } from \"../../utils/countries\";\nimport EventManager from \"../../utils/events\";\nimport { useCountryFromIP } from \"../../hooks/utils\";\nimport { CountryDrawer } from \"../../components/common/CountryDrawer\";\nimport { Becca } from \"../../api\";\nimport { useLanguage, useSetLanguage } from \"../../contexts\";\nimport { ALL_LANGUAGES } from \"../../components/global/translateUtils\";\nimport { useHistory } from 'react-router-dom';\nimport styles from \"./CreateShopDesktop.module.css\";\nconst schema = Yup.object().shape({\n  name: Yup.string().required().label('shop name'),\n  slug: Yup.string().required().min(4).label('shop url'),\n  country: Yup.string().required().label('country')\n});\nconst currencies = getCountries().map(x => ({\n  label: x.currency,\n  value: x.currency\n}));\n\nfunction CreateShop() {\n  _s();\n\n  const [name, setName] = useState('');\n  const [slug, setSlug] = useState('');\n  const [errors, setErrors] = useState({});\n  const language = useLanguage();\n  const [storeLang, setStoreLang] = useState(language || 'en');\n  const storeSelected = ALL_LANGUAGES.find(x => x.value === storeLang);\n  const [subscribe] = useToggle(true);\n  const setLanguage = useSetLanguage();\n  const [openCountryDrawer, toggleCountryDrawer] = useToggle(false);\n  const [country, setCountry, currency, setCurrency] = useCountryFromIP('', '', true);\n  const history = useHistory();\n\n  const createShop = async () => {\n    try {\n      setErrors({});\n      const obj = {\n        name,\n        slug,\n        country,\n        currency,\n        tos: {\n          whatsapp: {\n            subscribed: subscribe\n          }\n        }\n      };\n      await schema.validate(obj, {\n        abortEarly: false\n      });\n\n      if (!obj.config) {\n        obj.config = {};\n      }\n\n      obj.config.lang = storeLang;\n      await Becca.createShop(obj);\n      EventManager.emitEvent('shop_created', {\n        name,\n        slug,\n        country\n      });\n      setLanguage(storeLang);\n      history.go();\n    } catch (e) {\n      var _e$response, _e$response$data;\n\n      if (e.name === 'ValidationError') {\n        setErrors(e.inner.reduce((acc, err) => {\n          acc[err.path] = err.message;\n          return acc;\n        }, {}));\n        return;\n      }\n\n      const error = e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : (_e$response$data = _e$response.data) === null || _e$response$data === void 0 ? void 0 : _e$response$data.message;\n\n      if (error) {\n        if (error.toLowerCase() === 'shop url already taken') {\n          setErrors({\n            slug: 'URL already exists'\n          });\n          SnackBar.show('URL already exists', 'error');\n          return;\n        }\n\n        SnackBar.show(error, 'error');\n        return;\n      }\n\n      SnackBar.show('shop creation failed', 'error');\n    }\n  };\n\n  const onShopNameChange = () => name => {\n    const slug = name.replace(/[^A-Za-z0-9_]/g, '').replace(/_+/g, '').toLowerCase();\n    setName(name);\n    setSlug(slug);\n  };\n\n  const onSetSlug = () => slug => {\n    setSlug(slug.toLowerCase());\n  };\n\n  const onCountryChange = ({\n    value,\n    currrency\n  }) => {\n    setCountry(value);\n    setCurrency(currrency);\n    toggleCountryDrawer();\n  };\n\n  const onCurrencyChange = currrency => {\n    setCurrency(currrency.value);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    className: styles.leftGrid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.containerItems,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: createYourShopIcon,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.containerText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    className: styles.rightGrid,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.drawer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.header,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 11\n    }\n  }, \"Create Your Shop\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.overflow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(ReactInput, {\n    label: \"Enter Shop Name\",\n    placeholder: \"e.g. brilliant boutique\",\n    setValue: onShopNameChange(),\n    value: name,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 13\n    }\n  }), (errors === null || errors === void 0 ? void 0 : errors.name) && /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.error,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 31\n    }\n  }, errors.name), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.shopUrl,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 13\n    }\n  }, \"Shop URL\"), /*#__PURE__*/React.createElement(ReactInput, {\n    placeholder: \"e.g. brilliantboutique\",\n    startLabel: \"mywindo.shop/\",\n    value: slug,\n    setValue: onSetSlug(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 13\n    }\n  }), (errors === null || errors === void 0 ? void 0 : errors.slug) && /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.error,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 31\n    }\n  }, errors.slug), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.helperText,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 13\n    }\n  }, \"Create your custom shop link to share shop and products with your customer\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.country,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 13\n    }\n  }, openCountryDrawer && /*#__PURE__*/React.createElement(CountryDrawer, {\n    onSelect: onCountryChange,\n    onBack: toggleCountryDrawer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Clickable, {\n    className: styles.countrySelect,\n    onClick: toggleCountryDrawer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.cLabel,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 19\n    }\n  }, \"Select Country\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.cValue,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.ellipsis,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 21\n    }\n  }, country.toLowerCase() === 'usa' ? 'USA' : country), /*#__PURE__*/React.createElement(\"img\", {\n    src: chevron,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 21\n    }\n  }))), (errors === null || errors === void 0 ? void 0 : errors.country) && /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.error,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 38\n    }\n  }, errors.country)), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    options: currencies,\n    label: \"Currency\",\n    value: currencies.find(c => c.value === currency),\n    onChange: e => onCurrencyChange(e),\n    isDisabled: false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 17\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    translate: \"no\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Select, {\n    options: ALL_LANGUAGES,\n    label: \"Select Language\",\n    onChange: val => setStoreLang(val.value),\n    value: storeSelected,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: styles.helperTextD,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 15\n    }\n  }, \"You can always change your language later in settings\"))), /*#__PURE__*/React.createElement(Button, {\n    className: styles.submitButton,\n    size: \"large\",\n    label: \"Create Shop\",\n    onClick: createShop,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 11\n    }\n  }))));\n}\n\n_s(CreateShop, \"l4NaeqcArIoO92ne3y+ymfUauYk=\", false, function () {\n  return [useLanguage, useToggle, useSetLanguage, useToggle, useCountryFromIP, useHistory];\n});\n\n_c = CreateShop;\nCreateShop.propTypes = {};\nCreateShop.defaultProps = {};\nexport default CreateShop;\n\nvar _c;\n\n$RefreshReg$(_c, \"CreateShop\");","map":{"version":3,"sources":["/home/harish/windo/phoenix/src/containers/shop/CreateShopDesktop.jsx"],"names":["React","useState","ReactInput","Select","Button","Clickable","Yup","Grid","SnackBar","useToggle","getCountries","EventManager","useCountryFromIP","CountryDrawer","Becca","useLanguage","useSetLanguage","ALL_LANGUAGES","useHistory","styles","schema","object","shape","name","string","required","label","slug","min","country","currencies","map","x","currency","value","CreateShop","setName","setSlug","errors","setErrors","language","storeLang","setStoreLang","storeSelected","find","subscribe","setLanguage","openCountryDrawer","toggleCountryDrawer","setCountry","setCurrency","history","createShop","obj","tos","whatsapp","subscribed","validate","abortEarly","config","lang","emitEvent","go","e","inner","reduce","acc","err","path","message","error","response","data","toLowerCase","show","onShopNameChange","replace","onSetSlug","onCountryChange","currrency","onCurrencyChange","container","leftGrid","containerItems","createYourShopIcon","containerText","rightGrid","drawer","header","overflow","shopUrl","helperText","countrySelect","cLabel","cValue","ellipsis","chevron","c","val","helperTextD","submitButton","propTypes","defaultProps"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport createYourShopIcon from 'assets/v2/onboarding/createYourShopDesk.svg';\nimport chevron from 'assets/v2/onboarding/chevronDown.svg';\nimport {\n  ReactInput, Select, Button, Clickable\n} from 'phoenix-components';\nimport * as Yup from 'yup';\nimport {\n  Grid,\n} from '@material-ui/core';\nimport SnackBar from 'services/snackbar';\nimport { useToggle } from 'hooks/common';\nimport { getCountries } from 'utils/countries';\nimport EventManager from 'utils/events';\nimport { useCountryFromIP } from 'hooks/utils';\nimport { CountryDrawer } from 'components/common/CountryDrawer';\nimport { Becca } from 'api';\nimport { useLanguage, useSetLanguage } from 'contexts';\nimport { ALL_LANGUAGES } from 'components/global/translateUtils';\nimport { useHistory } from 'react-router-dom';\nimport styles from './CreateShopDesktop.module.css';\n\nconst schema = Yup.object().shape({\n  name: Yup.string().required().label('shop name'),\n  slug: Yup.string().required().min(4).label('shop url'),\n  country: Yup.string().required().label('country'),\n});\n\nconst currencies = getCountries().map(x => ({ label: x.currency, value: x.currency }));\n\nfunction CreateShop() {\n  const [name, setName] = useState('');\n  const [slug, setSlug] = useState('');\n  const [errors, setErrors] = useState({});\n  const language = useLanguage();\n  const [storeLang, setStoreLang] = useState(language || 'en');\n  const storeSelected = ALL_LANGUAGES.find(x => x.value === storeLang);\n  const [subscribe] = useToggle(true);\n  const setLanguage = useSetLanguage();\n  const [openCountryDrawer, toggleCountryDrawer] = useToggle(false);\n  const [country, setCountry, currency, setCurrency] = useCountryFromIP('', '', true);\n  const history = useHistory();\n\n  const createShop = async () => {\n    try {\n      setErrors({});\n      const obj = {\n        name, slug, country, currency, tos: { whatsapp: { subscribed: subscribe } }\n      };\n      await schema.validate(obj, {\n        abortEarly: false\n      });\n      if (!obj.config) {\n        obj.config = {};\n      }\n      obj.config.lang = storeLang;\n      await Becca.createShop(obj);\n      EventManager.emitEvent('shop_created', {\n        name, slug, country,\n      });\n      setLanguage(storeLang);\n      history.go();\n    } catch (e) {\n      if (e.name === 'ValidationError') {\n        setErrors(e.inner.reduce((acc, err) => {\n          acc[err.path] = err.message;\n          return acc;\n        }, {}));\n        return;\n      }\n      const error = e?.response?.data?.message;\n      if (error) {\n        if (error.toLowerCase() === 'shop url already taken') {\n          setErrors({ slug: 'URL already exists' });\n          SnackBar.show('URL already exists', 'error');\n          return;\n        }\n        SnackBar.show(error, 'error');\n        return;\n      }\n      SnackBar.show('shop creation failed', 'error');\n    }\n  };\n\n  const onShopNameChange = () => (name) => {\n    const slug = name.replace(/[^A-Za-z0-9_]/g, '')\n      .replace(/_+/g, '').toLowerCase();\n    setName(name);\n    setSlug(slug);\n  };\n\n  const onSetSlug = () => (slug) => {\n    setSlug(slug.toLowerCase());\n  };\n\n  const onCountryChange = ({ value, currrency }) => {\n    setCountry(value);\n    setCurrency(currrency);\n    toggleCountryDrawer();\n  };\n  const onCurrencyChange = (currrency) => {\n    setCurrency(currrency.value);\n  };\n\n  return (\n    <div className={styles.container}>\n      <Grid item xs={6} className={styles.leftGrid}>\n        <div className={styles.containerItems}>\n          <img src={createYourShopIcon} alt=\"\" />\n          <div className={styles.containerText}>\n          </div>\n        </div>\n      </Grid>\n      <Grid item xs={6} className={styles.rightGrid}>\n        <div className={styles.drawer}>\n          <div className={styles.header}>\n            Create Your Shop\n          </div>\n          <div className={styles.overflow}>\n            <ReactInput\n              label=\"Enter Shop Name\"\n              placeholder=\"e.g. brilliant boutique\"\n              setValue={onShopNameChange()}\n              value={name}\n            />\n            {errors?.name && (<div className={styles.error}>{errors.name}</div>)}\n            <div className={styles.shopUrl}>Shop URL</div>\n            <ReactInput\n              placeholder=\"e.g. brilliantboutique\"\n              startLabel=\"mywindo.shop/\"\n              value={slug}\n              setValue={onSetSlug()}\n            />\n            {errors?.slug && (<div className={styles.error}>{errors.slug}</div>)}\n            <div className={styles.helperText}>\n              {/* You can always connect your custom domain later */}\n              Create your custom shop link to share shop and products with your customer\n            </div>\n            <div className={styles.country}>\n              {openCountryDrawer && (\n                <CountryDrawer onSelect={onCountryChange} onBack={toggleCountryDrawer} />\n              )}\n              <div>\n                <Clickable\n                  className={styles.countrySelect}\n                  onClick={toggleCountryDrawer}\n                >\n                  <div className={styles.cLabel}>\n                    Select Country\n                  </div>\n                  <div className={styles.cValue}>\n                    <div className={styles.ellipsis}>\n                      {country.toLowerCase() === 'usa' ? 'USA' : country }\n                    </div>\n                    <img src={chevron} alt=\"\" />\n                  </div>\n                  {/* <Select\n                        options={countries}\n                        label=\"Select Country\"\n                        disabled\n                        onChange={onCountryChange}\n                        value={countries.find(c => c.value === country)}\n                      /> */}\n                </Clickable>\n                {errors?.country && (<div className={styles.error}>{errors.country}</div>)}\n              </div>\n              <div>\n                <Select\n                  options={currencies}\n                  label=\"Currency\"\n                  value={currencies.find(c => c.value === currency)}\n                  onChange={(e) => onCurrencyChange(e)}\n                  isDisabled={false}\n                />\n              </div>\n            </div>\n            <div translate=\"no\">\n              <Select\n                options={ALL_LANGUAGES}\n                label=\"Select Language\"\n                onChange={(val) => setStoreLang(val.value)}\n                value={storeSelected}\n              />\n              <div className={styles.helperTextD}>\n                You can always change your language later in settings\n              </div>\n            </div>\n            {/* <ReactInput\n              startLabelMain=\"Phone\"\n              startLabel={getLabel()}\n              placeholder=\"Phone number\"\n              value={phone}\n              setValue={(e) => {\n                setPhone(e);\n              }}\n            /> */}\n            {/* {errors?.phone && (<div className={styles.error}>{errors.phone}</div>)} */}\n            {/* {!showCode && (\n              <Clickable className={styles.code} onClick={toggleCode}>\n                Have Referral code?\n              </Clickable>\n            )}\n            {showCode && (\n              <div className={styles.referralCode}>\n                <ReactInput\n                  label=\"Referral Code\"\n                  placeholder=\"e.g. 23ABCD\"\n                  value={referralCode}\n                  setValue={setReferralCode}\n                />\n              </div>\n            )}\n            {errors?.referralCode && (<div className={styles.error}>{errors.referralCode}</div>)} */}\n            {/* <div className={styles.card}>\n              <img src={waIcon} alt=\"\" />\n              <div className={styles.cardLabel}>\n                Opt in for Whatsapp updates\n              </div>\n              <Switch2\n                active={subscribe}\n                onChange={setSubscribe}\n                value={subscribe}\n              />\n            </div> */}\n          </div>\n          <Button\n            className={styles.submitButton}\n            size=\"large\"\n            label=\"Create Shop\"\n            onClick={createShop}\n          />\n        </div>\n      </Grid>\n    </div>\n  );\n}\n\nCreateShop.propTypes = {};\n\nCreateShop.defaultProps = {};\n\nexport default CreateShop;\n"]},"metadata":{},"sourceType":"module"}